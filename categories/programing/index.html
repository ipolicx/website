<!DOCTYPE html>
<html lang="zh">
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
<title>分类: programing - POLICX</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">



    <meta property="og:type" content="website">
<meta property="og:title" content="POLICX">
<meta property="og:url" content="http://yoursite.com/categories/programing/index.html">
<meta property="og:site_name" content="POLICX">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://yoursite.com/images/og_image.png">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="POLICX">
<meta name="twitter:image" content="http://yoursite.com/images/og_image.png">







<link rel="icon" href="/images/favicon.ico">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/github.css">


    
    
    
    <style>body>.footer,body>.navbar,body>.section{opacity:0}</style>
    

    
    
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css">
    

    
    

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css">


    
    
    
    

<link rel="stylesheet" href="/css/back-to-top.css">


    
    
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-142191817-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-142191817-1');
</script>


    
    
    
    

    
    
<link rel="stylesheet" href="/css/progressbar.css">
<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>

    
    
    

    
    
    
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    

    


<link rel="stylesheet" href="/css/style.css">
</head>
<body class="is-3-column">
    <nav class="navbar navbar-main">
    <div class="container">
        <div class="navbar-brand is-flex-center">
            <a class="navbar-item navbar-logo" href="/">
            
                <img src="/images/logo.gif" alt="POLICX" height="28">
            
            </a>
        </div>
        <div class="navbar-menu">
            
            <div class="navbar-start">
                
                <a class="navbar-item" href="/">Home</a>
                
                <a class="navbar-item" href="/archives">Archives</a>
                
                <a class="navbar-item" href="/categories">Categories</a>
                
                <a class="navbar-item" href="/tags">Tags</a>
                
                <a class="navbar-item" href="/message">Message</a>
                
                <a class="navbar-item" href="/about">About</a>
                
            </div>
            
            <div class="navbar-end">
                
                    
                    
                    <a class="navbar-item" target="_blank" title="Download on GitHub" href="https://www.2345.com/?k.cn">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                    
                
                
                
                <a class="navbar-item search" title="搜索" href="javascript:;">
                    <i class="fas fa-search"></i>
                </a>
                
            </div>
        </div>
    </div>
</nav>
    
    <section class="section">
        <div class="container">
            <div class="columns">
                <div class="column is-8-tablet is-8-desktop is-6-widescreen has-order-2 column-main"><div class="card">
    <div class="card-content">
        <nav class="breadcrumb" aria-label="breadcrumbs">
        <ul>
            <li><a href="/categories">分类</a></li>
            
            <li class="is-active"><a href="#" aria-current="page">programing</a></li>
        </ul>
        </nav>
    </div>
</div>

    <div class="card">
    
    <div class="card-image">
        <a href="/2018/04/18/django-bi-ji/" class="image is-7by1">
            <img class="thumbnail" src="https://www.policx.com/talk/images/python-django.jpg" alt="Django笔记">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2018-04-17T17:00:16.000Z">2018-04-18</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/programing/">programing</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    5 分钟 读完 (大约 745 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2018/04/18/django-bi-ji/">Django笔记</a>
            
        </h1>
        <div class="content">
            <p>Django是一个开放源代码的Web应用框架，由Python写成。采用了MTV的框架模式，即模型M，视图V和模版T。它最初是被开发来用于管理劳伦斯出版集团旗下的一些以新闻内容为主的网站的，即是CMS（内容管理系统）软件。并于2005年7月在BSD许可证下发布。这套框架是以比利时的吉普赛爵士吉他手Django Reinhardt来命名的。</p>
        </div>
        
        
        <div class="level is-mobile">
            <div class="level-start">
                <div class="level-item">
                <a class="button is-size-7 is-light" href="/2018/04/18/django-bi-ji/#more">阅读更多</a>
                </div>
            </div>
        </div>
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-image">
        <a href="/2018/04/17/django/" class="image is-7by1">
            <img class="thumbnail" src="https://www.policx.com/talk/images/python-django.jpg" alt="Django部署——uwsgi+Nginx">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2018-04-17T09:42:04.000Z">2018-04-17</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/programing/">programing</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    6 分钟 读完 (大约 892 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2018/04/17/django/">Django部署——uwsgi+Nginx</a>
            
        </h1>
        <div class="content">
            <p>用Django写了个小网站，只能在自己本地跑一跑！这怎么行？听说可以部署在云服务器上，这样别人就可以访问了!</p>
        </div>
        
        
        <div class="level is-mobile">
            <div class="level-start">
                <div class="level-item">
                <a class="button is-size-7 is-light" href="/2018/04/17/django/#more">阅读更多</a>
                </div>
            </div>
        </div>
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-image">
        <a href="/2018/02/06/ip/" class="image is-7by1">
            <img class="thumbnail" src="https://www.policx.com/talk/images/denglu.jpg" alt="移动端网络请求优化之 IP 测速排序方案">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2018-02-06T08:17:03.000Z">2018-02-06</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/programing/">programing</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    8 分钟 读完 (大约 1266 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2018/02/06/ip/">移动端网络请求优化之 IP 测速排序方案</a>
            
        </h1>
        <div class="content">
            <p>IP 测速排序方案</p>
        </div>
        
        
        <div class="level is-mobile">
            <div class="level-start">
                <div class="level-item">
                <a class="button is-size-7 is-light" href="/2018/02/06/ip/#more">阅读更多</a>
                </div>
            </div>
        </div>
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-image">
        <a href="/2018/02/06/KVOcrash/" class="image is-7by1">
            <img class="thumbnail" src="https://www.policx.com/talk/images/denglu.jpg" alt="KVO crash 自修复技术实现与原理解析">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2018-02-06T07:44:53.000Z">2018-02-06</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/programing/">programing</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    11 分钟 读完 (大约 1597 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2018/02/06/KVOcrash/">KVO crash 自修复技术实现与原理解析</a>
            
        </h1>
        <div class="content">
            <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><hr>
<p>【前言】KVO API设计非常不合理，于是有很多的KVO三方库，比如 KVOController 用更优的API来规避这些crash，但是侵入性比较大，必须编码规范来约束所有人都要使用该方式。有没有什么更优雅，无感知的接入方式？</p>
        </div>
        
        
        <div class="level is-mobile">
            <div class="level-start">
                <div class="level-item">
                <a class="button is-size-7 is-light" href="/2018/02/06/KVOcrash/#more">阅读更多</a>
                </div>
            </div>
        </div>
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-image">
        <a href="/2018/02/06/crash/" class="image is-7by1">
            <img class="thumbnail" src="https://www.policx.com/talk/images/denglu.jpg" alt="连续启动 crash 自修复技术实现与原理解析">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2018-02-06T07:21:18.000Z">2018-02-06</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/programing/">programing</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    22 分钟 读完 (大约 3286 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2018/02/06/crash/">连续启动 crash 自修复技术实现与原理解析</a>
            
        </h1>
        <div class="content">
            <ul>
<li>前言</li>
<li>实现原理</li>
<li>优化：降低50%以上误报机率</li>
<li>对原有API设计的几点优化意见</li>
<li><ol>
<li>机制状态应当用枚举来做为API透出</li>
</ol>
</li>
<li><ol start="2">
<li>关键数值应当做为初始化参数供用户设置</li>
</ol>
</li>
<li><ol start="3">
<li>修复、上报逻辑应当支持用户异步操作</li>
</ol>
</li>
<li>什么时候会出现该异常？</li>
<li>连续启动 crash 自修复技术实现与原理解析</li>
</ul>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><hr>
<blockquote>
<p>如果 app 连续 crash 两次无法启动，用户往往会选择卸载。</p>
</blockquote>
<p>连续启动 crash 应该是 crash 类型中最严重的一类，该问题常常与数据库操作有关，比如：数据库损坏、服务端返回数据错误，存入数据库，app 读取时产生数组越界、找不到方法。</p>
<p>那么除了热修复，能否“自修复”该问题呢？</p>
<p>在微信读书团队发布的<a href="https://wereadteam.github.io/2016/05/23/GYBootingProtection/" target="_blank" rel="noopener">《iOS 启动连续闪退保护方案》</a> 一文中，给出了连续启动crash的自修复技术的思路讲解，并在GitHub上给出了技术实现，并开源了<a href="https://github.com/liuslevis/GYBootingProtection" target="_blank" rel="noopener"> GYBootingProtection</a>。方案思路很好，很轻量级。</p>
<h2 id="实现原理"><a href="#实现原理" class="headerlink" title="实现原理"></a>实现原理</h2><hr>
<p>在微信读书团队给出的文章中已经有比较详细的阐述，在此不做赘述，实现的流程图如下所示：<br><a href></a><br>但有个实现上可以优化下，可以降低50%以上误报机率，监听用户手动划掉 APP 这个事件，其中一些特定场景，是可以获取的。另外在这里也给出对其 API 设计的建议。最后给出优化后的实现。</p>
<h2 id="优化：降低50-以上误报机率"><a href="#优化：降低50-以上误报机率" class="headerlink" title="优化：降低50%以上误报机率"></a>优化：降低50%以上误报机率</h2><hr>
<p>用户主动 kill 掉 APP 分为两种情况：</p>
<ul>
<li>App在前台时用户手动划掉APP的时候</li>
<li>APP在后台时划掉APP</li>
</ul>
<p>第一种场景更为常见，可以通过监听 UIApplicationWillTerminateNotification 来捕获该动作，捕获后恢复计数。第二种情况，无法监听到。但也足以降低 50% 以上的误报机率。</p>
<h3 id="对原有API设计的几点优化意见"><a href="#对原有API设计的几点优化意见" class="headerlink" title="对原有API设计的几点优化意见"></a>对原有API设计的几点优化意见</h3><h4 id="1-机制状态应当用枚举来做为API透出"><a href="#1-机制状态应当用枚举来做为API透出" class="headerlink" title="1. 机制状态应当用枚举来做为API透出"></a>1. 机制状态应当用枚举来做为API透出</h4><p>该机制当前所处的状态，比如：NeedFix 、isFixing，建议用枚举来做为API透出。比如：</p>
<ul>
<li>APP 启动正常</li>
<li>正在检测是否会在特定时间内是否会 Crash，注意：检测状态下“连续启动崩溃计数”个数小于或等于上限值</li>
<li>APP 出现连续启动 Crash，需要采取修复措施</li>
<li>APP 出现连续启动 Crash，正在修复中</li>
</ul>
<h4 id="2-关键数值应当做为初始化参数供用户设置"><a href="#2-关键数值应当做为初始化参数供用户设置" class="headerlink" title="2. 关键数值应当做为初始化参数供用户设置"></a>2. 关键数值应当做为初始化参数供用户设置</h4><ul>
<li>当前启动Crash的状态</li>
<li>达到需要执行上报操作的“连续启动崩溃计数”个数。</li>
<li>达到需要执行修复操作的“连续启动崩溃计数”个数。</li>
<li>APP 启动后经过多少秒，可以将“连续启动崩溃计数”清零</li>
</ul>
<h4 id="3-修复、上报逻辑应当支持用户异步操作"><a href="#3-修复、上报逻辑应当支持用户异步操作" class="headerlink" title="3. 修复、上报逻辑应当支持用户异步操作"></a>3. 修复、上报逻辑应当支持用户异步操作</h4><p><code>reportBlock</code> 上报逻辑，<br><code>repairtBlock</code> 修复逻辑</p>
<p>比如：</p>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">typedef void (^BoolCompletionHandler)(BOOL succeeded, NSError *error);</span><br><span class="line">typedef void (^RepairBlock)(ABSBoolCompletionHandler completionHandler);</span><br></pre></td></tr></table></figure>

<p>用户执行 BoolCompletionHandler 后即可知道是否执行完毕，并且支持异步操作。</p>
<p>异步操作带来的问题，可以通过前面提到的枚举API来实时监测状态，来决定各种其他操作。</p>
<h2 id="什么时候会出现该异常？"><a href="#什么时候会出现该异常？" class="headerlink" title="什么时候会出现该异常？"></a>什么时候会出现该异常？</h2><h3 id="连续启动-crash-自修复技术实现与原理解析"><a href="#连续启动-crash-自修复技术实现与原理解析" class="headerlink" title="连续启动 crash 自修复技术实现与原理解析"></a>连续启动 crash 自修复技术实现与原理解析</h3><p>下面给出优化后的代码实现：</p>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">//</span><br><span class="line">//  CYLBootingProtection.h</span><br><span class="line">//  </span><br><span class="line">//</span><br><span class="line">//  Created by ChenYilong on 18/01/10.</span><br><span class="line">//  Copyright © 2018年 ChenYilong. All rights reserved.</span><br><span class="line">//</span><br><span class="line"></span><br><span class="line">#import &lt;Foundation/Foundation.h&gt;</span><br><span class="line"></span><br><span class="line">typedef void (^ABSBoolCompletionHandler)(BOOL succeeded, NSError *error);</span><br><span class="line">typedef void (^ABSRepairBlock)(ABSBoolCompletionHandler completionHandler);</span><br><span class="line">typedef void (^ABSReportBlock)(NSUInteger crashCounts);</span><br><span class="line"></span><br><span class="line">typedef NS_ENUM(NSInteger, BootingProtectionStatus) &#123;</span><br><span class="line">   BootingProtectionStatusNormal,  /**&lt;  APP 启动正常 */</span><br><span class="line">   BootingProtectionStatusNormalChecking,  /**&lt; 正在检测是否会在特定时间内是否会 Crash，注意：检测状态下“连续启动崩溃计数”个数小于或等于上限值 */</span><br><span class="line">   BootingProtectionStatusNeedFix, /**&lt; APP 出现连续启动 Crash，需要采取修复措施 */</span><br><span class="line">   BootingProtectionStatusFixing,   /**&lt; APP 出现连续启动 Crash，正在修复中... */</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line">* 启动连续 crash 保护。</span><br><span class="line">* 启动后 `_crashOnLaunchTimeIntervalThreshold` 秒内 crash，反复超过 `_continuousCrashOnLaunchNeedToReport` 次则上报日志，超过 `_continuousCrashOnLaunchNeedToFix` 则启动修复操作。</span><br><span class="line">*/</span><br><span class="line">@interface CYLBootingProtection : NSObject</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line">* 启动连续 crash 保护方法。</span><br><span class="line">* 前置条件：在 App 启动时注册 crash 处理函数，在 crash 时调用[CYLBootingProtection addCrashCountIfNeeded]。</span><br><span class="line">* 启动后一定时间内（`crashOnLaunchTimeIntervalThreshold`秒内）crash，反复超过一定次数（`continuousCrashOnLaunchNeedToReport`次）则上报日志，超过一定次数（`continuousCrashOnLaunchNeedToFix`次）则启动修复程序；在一定时间内（`crashOnLaunchTimeIntervalThreshold`秒） 秒后若没有 crash 将“连续启动崩溃计数”计数置零。</span><br><span class="line"> `reportBlock` 上报逻辑，</span><br><span class="line"> `repairtBlock` 修复逻辑，完成后执行 `[self setCrashCount:0]`</span><br><span class="line"></span><br><span class="line">*/</span><br><span class="line">- (void)launchContinuousCrashProtect;</span><br><span class="line"></span><br><span class="line">/*!</span><br><span class="line">* 当前启动Crash的状态</span><br><span class="line">*/</span><br><span class="line">@property (nonatomic, assign, readonly) BootingProtectionStatus bootingProtectionStatus;</span><br><span class="line"></span><br><span class="line">/*!</span><br><span class="line">* 达到需要执行上报操作的“连续启动崩溃计数”个数。</span><br><span class="line">*/</span><br><span class="line">@property (nonatomic, assign, readonly) NSUInteger continuousCrashOnLaunchNeedToReport;</span><br><span class="line"></span><br><span class="line">/*!</span><br><span class="line">* 达到需要执行修复操作的“连续启动崩溃计数”个数。</span><br><span class="line">*/</span><br><span class="line">@property (nonatomic, assign, readonly) NSUInteger continuousCrashOnLaunchNeedToFix;</span><br><span class="line"></span><br><span class="line">/*!</span><br><span class="line">* APP 启动后经过多少秒，可以将“连续启动崩溃计数”清零</span><br><span class="line">*/</span><br><span class="line">@property (nonatomic, assign, readonly) NSTimeInterval crashOnLaunchTimeIntervalThreshold;</span><br><span class="line"></span><br><span class="line">/*!</span><br><span class="line">* 借助 context 可以让多个模块注册事件，并且事件 block 能独立执行，互不干扰。</span><br><span class="line">*/</span><br><span class="line">@property (nonatomic, copy, readonly) NSString *context;</span><br><span class="line"></span><br><span class="line">/*!</span><br><span class="line">* @details 启动后kCrashOnLaunchTimeIntervalThreshold秒内crash，反复超过continuousCrashOnLaunchNeedToReport次则上报日志，超过continuousCrashOnLaunchNeedToFix则启动修复程序；当所有操作完成后，执行 completion。在 crashOnLaunchTimeIntervalThreshold 秒后若没有 crash 将 kContinuousCrashOnLaunchCounterKey 计数置零。</span><br><span class="line">* @param context 借助 context 可以让多个模块注册事件，并且事件 block 能独立执行，互不干扰。</span><br><span class="line">*/</span><br><span class="line">- (instancetype)initWithContinuousCrashOnLaunchNeedToReport:(NSUInteger)continuousCrashOnLaunchNeedToReport</span><br><span class="line">                          continuousCrashOnLaunchNeedToFix:(NSUInteger)continuousCrashOnLaunchNeedToFix</span><br><span class="line">                        crashOnLaunchTimeIntervalThreshold:(NSTimeInterval)crashOnLaunchTimeIntervalThreshold</span><br><span class="line">                                                   context:(NSString *)context;</span><br><span class="line">/*!</span><br><span class="line">* 当前“连续启动崩溃“的状态</span><br><span class="line">*/</span><br><span class="line">+ (BootingProtectionStatus)bootingProtectionStatusWithContext:(NSString *)context continuousCrashOnLaunchNeedToFix:(NSUInteger)continuousCrashOnLaunchNeedToFix;</span><br><span class="line"></span><br><span class="line">/*!</span><br><span class="line">* 设置上报逻辑，参数 crashCounts 为启动连续 crash 次数</span><br><span class="line">*/</span><br><span class="line">- (void)setReportBlock:(ABSReportBlock)reportBlock;</span><br><span class="line"></span><br><span class="line">/*!</span><br><span class="line">* 设置修复逻辑</span><br><span class="line">*/</span><br><span class="line">- (void)setRepairBlock:(ABSRepairBlock)repairtBlock;</span><br><span class="line"></span><br><span class="line">+ (void)setLogger:(void (^)(NSString *))logger;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>

<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br></pre></td><td class="code"><pre><span class="line">//</span><br><span class="line">//  CYLBootingProtection.m</span><br><span class="line">//</span><br><span class="line">//</span><br><span class="line">//  Created by ChenYilong on 18/01/10.</span><br><span class="line">//  Copyright © 2018年 ChenYilong. All rights reserved.</span><br><span class="line">//</span><br><span class="line"></span><br><span class="line">#import &quot;CYLBootingProtection.h&quot;</span><br><span class="line">#import &lt;UIKit/UIKit.h&gt;</span><br><span class="line"></span><br><span class="line">static dispatch_queue_t _exceptionOperationQueue = 0;</span><br><span class="line">void (^Logger)(NSString *log);</span><br><span class="line"></span><br><span class="line">@interface CYLBootingProtection ()</span><br><span class="line"></span><br><span class="line">@property (nonatomic, assign) NSUInteger continuousCrashOnLaunchNeedToReport;</span><br><span class="line">@property (nonatomic, assign) NSUInteger continuousCrashOnLaunchNeedToFix;</span><br><span class="line">@property (nonatomic, assign) NSTimeInterval crashOnLaunchTimeIntervalThreshold;</span><br><span class="line">@property (nonatomic, copy) NSString *context;</span><br><span class="line">@property (nonatomic, copy) ABSReportBlock reportBlock;</span><br><span class="line">@property (nonatomic, copy) ABSRepairBlock repairBlock;</span><br><span class="line"></span><br><span class="line">/*!</span><br><span class="line">* 设置“连续启动崩溃计数”个数</span><br><span class="line">*/</span><br><span class="line">- (void)setCrashCount:(NSInteger)count;</span><br><span class="line"></span><br><span class="line">/*!</span><br><span class="line">* 设置“连续启动崩溃计数”个数</span><br><span class="line">*/</span><br><span class="line">+ (void)setCrashCount:(NSUInteger)count context:(NSString *)context;</span><br><span class="line"></span><br><span class="line">/*!</span><br><span class="line">* “连续启动崩溃计数”个数</span><br><span class="line">*/</span><br><span class="line">- (NSUInteger)crashCount;</span><br><span class="line"></span><br><span class="line">/*!</span><br><span class="line">* “连续启动崩溃计数”个数</span><br><span class="line">*/</span><br><span class="line">+ (NSUInteger)crashCountWithContext:(NSString *)context;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation CYLBootingProtection</span><br><span class="line">+ (void)initialize &#123;</span><br><span class="line">   static dispatch_once_t onceToken;</span><br><span class="line">   dispatch_once(&amp;onceToken, ^&#123;</span><br><span class="line">       _exceptionOperationQueue = dispatch_queue_create(&quot;com.ChenYilong.CYLBootingProtection.fileCacheQueue&quot;, DISPATCH_QUEUE_SERIAL);</span><br><span class="line">   &#125;);</span><br><span class="line">&#125;</span><br><span class="line">- (instancetype)initWithContinuousCrashOnLaunchNeedToReport:(NSUInteger)continuousCrashOnLaunchNeedToReport</span><br><span class="line">                          continuousCrashOnLaunchNeedToFix:(NSUInteger)continuousCrashOnLaunchNeedToFix</span><br><span class="line">                        crashOnLaunchTimeIntervalThreshold:(NSTimeInterval)crashOnLaunchTimeIntervalThreshold</span><br><span class="line">                                                   context:(NSString *)context &#123;</span><br><span class="line">   if (!(self = [super init])) &#123;</span><br><span class="line">       return nil;</span><br><span class="line">   &#125;</span><br><span class="line">   _continuousCrashOnLaunchNeedToReport = continuousCrashOnLaunchNeedToReport;</span><br><span class="line">   _continuousCrashOnLaunchNeedToFix = continuousCrashOnLaunchNeedToFix;</span><br><span class="line">   _crashOnLaunchTimeIntervalThreshold = crashOnLaunchTimeIntervalThreshold;</span><br><span class="line">   _context = [context copy];</span><br><span class="line">   [[NSNotificationCenter defaultCenter] addObserver:self</span><br><span class="line">                                            selector:@selector(applicationWillTerminate:)</span><br><span class="line">                                                name:UIApplicationWillTerminateNotification</span><br><span class="line">                                              object:[UIApplication sharedApplication]];</span><br><span class="line">   return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/*!</span><br><span class="line">* App在前台时用户手动划掉APP的时候，不计入检测。</span><br><span class="line">* 但是APP在后台时划掉APP，无法检测出来。</span><br><span class="line">* 见：https://stackoverflow.com/a/35041565/3395008</span><br><span class="line">*/</span><br><span class="line">- (void)applicationWillTerminate:(NSNotification *)note &#123;</span><br><span class="line">   BOOL isNormalChecking = [self isNormalChecking];</span><br><span class="line">   if (isNormalChecking) &#123;</span><br><span class="line">       [self decreaseCrashCount];</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)dealloc &#123;</span><br><span class="line">   [[NSNotificationCenter defaultCenter] removeObserver:self];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">支持同步修复、异步修复，两种修复方式</span><br><span class="line">- 异步修复，不卡顿主UI，但有修复未完成就被再次触发crash、或者用户kill掉的可能。需要用户手动根据修复状态，来选择性地进行操作，应该有回掉。</span><br><span class="line">- 同步修复，最简单直观，在主线程删除或者下载修复包。</span><br><span class="line">*/</span><br><span class="line">- (void)launchContinuousCrashProtect &#123;</span><br><span class="line">   NSAssert(_repairBlock, @&quot;_repairBlock is nil!&quot;);</span><br><span class="line">   [[self class] Logger:@&quot;CYLBootingProtection: Launch continuous crash report&quot;];</span><br><span class="line">   [self resetBootingProtectionStatus];</span><br><span class="line">   </span><br><span class="line">   NSUInteger launchCrashes = [self crashCount];</span><br><span class="line">   // 上报</span><br><span class="line">   if (launchCrashes &gt;= self.continuousCrashOnLaunchNeedToReport) &#123;</span><br><span class="line">       NSString *logString = [NSString stringWithFormat:@&quot;CYLBootingProtection: App has continuously crashed for %@ times. Now synchronize uploading crash report and begin fixing procedure.&quot;, @(launchCrashes)];</span><br><span class="line">       [[self class] Logger:logString];</span><br><span class="line">       if (_reportBlock) &#123;</span><br><span class="line">           dispatch_async(dispatch_get_main_queue(),^&#123;</span><br><span class="line">               _reportBlock(launchCrashes);</span><br><span class="line">           &#125;);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   // 修复</span><br><span class="line">   if ([self isUpToBootingProtectionCount]) &#123;</span><br><span class="line">       [[self class] Logger:@&quot;need to repair&quot;];</span><br><span class="line">       [self setIsFixing:YES];</span><br><span class="line">       if (_repairBlock) &#123;</span><br><span class="line">           ABSBoolCompletionHandler completionHandler = ^(BOOL succeeded, NSError *__nullable error)&#123;</span><br><span class="line">               if (succeeded) &#123;</span><br><span class="line">                   [self resetCrashCount];</span><br><span class="line">               &#125; else &#123;</span><br><span class="line">                   [[self class] Logger:error.description];</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;;</span><br><span class="line">           dispatch_async(dispatch_get_main_queue(),^&#123;</span><br><span class="line">               _repairBlock(completionHandler);</span><br><span class="line">           &#125;);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125; else &#123;</span><br><span class="line">       [self increaseCrashCount:launchCrashes];</span><br><span class="line">       // 正常流程，无需修复</span><br><span class="line">       [[self class] Logger:@&quot;need no repair&quot;];</span><br><span class="line">       </span><br><span class="line">       // 记录启动时刻，用于计算启动连续 crash</span><br><span class="line">       // 重置启动 crash 计数</span><br><span class="line">       dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(self.crashOnLaunchTimeIntervalThreshold * NSEC_PER_SEC)), dispatch_get_main_queue(), ^(void)&#123;</span><br><span class="line">           // APP活过了阈值时间，重置崩溃计数</span><br><span class="line">           NSString *logString = [NSString stringWithFormat:@&quot;CYLBootingProtection: long live the app ( more than %@ seconds ), now reset crash counts&quot;, @(self.crashOnLaunchTimeIntervalThreshold)];</span><br><span class="line">           [[self class] Logger:logString];</span><br><span class="line">           [self resetCrashCount];</span><br><span class="line">       &#125;);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//减少计数的时机：用户手动划掉APP</span><br><span class="line">- (void)decreaseCrashCount &#123;</span><br><span class="line">   NSUInteger oldCrashCount = [self crashCount];</span><br><span class="line">   [self decreaseCrashCountWithOldCrashCount:oldCrashCount];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)decreaseCrashCountWithOldCrashCount:(NSUInteger)oldCrashCount &#123;</span><br><span class="line">   dispatch_sync(_exceptionOperationQueue, ^&#123;</span><br><span class="line">       if (oldCrashCount &gt; 0) &#123;</span><br><span class="line">           [self setCrashCount:oldCrashCount-1];</span><br><span class="line">       &#125;</span><br><span class="line">       [self resetBootingProtectionStatus];</span><br><span class="line">   &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//重制计数的时机：修复完成、或者用户手动划掉APP</span><br><span class="line">- (void)resetCrashCount &#123;</span><br><span class="line">   [self setCrashCount:0];</span><br><span class="line">   [self resetBootingProtectionStatus];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//只在未达到计数上限时才会增加计数</span><br><span class="line">- (void)increaseCrashCount:(NSUInteger)oldCrashCount &#123;</span><br><span class="line">   dispatch_sync(_exceptionOperationQueue, ^&#123;</span><br><span class="line">       [self setIsNormalChecking:YES];</span><br><span class="line">       [self setCrashCount:oldCrashCount+1];</span><br><span class="line">   &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)resetBootingProtectionStatus &#123;</span><br><span class="line">   [self setIsNormalChecking:NO];</span><br><span class="line">   [self setIsFixing:NO];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (BootingProtectionStatus)bootingProtectionStatus &#123;</span><br><span class="line">   return [[self class] bootingProtectionStatusWithContext:_context continuousCrashOnLaunchNeedToFix:_continuousCrashOnLaunchNeedToFix];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/*!</span><br><span class="line">*</span><br><span class="line">@attention 注意之所以要检查 `BootingProtectionStatusNormalChecking` 原因如下：</span><br><span class="line"></span><br><span class="line">`-launchContinuousCrashProtect` 方法与 `-bootingProtectionStatus` 方法，如果 `-launchContinuousCrashProtect` 先执行，那么会造成如下问题：</span><br><span class="line">假设n为上限，但crash（n-1）次，但是用 `-bootingProtectionStatus` 判断出来，当前已经处于n次了。原因如下：</span><br><span class="line"></span><br><span class="line">crash（n-1）次，正常流程，计数+1，变成n次，</span><br><span class="line">随后在检查 `-bootingProtectionStatus` 时，发现已经处于异常状态了，实际是正常状态。所以需要使用`BootingProtectionStatusNormalChecking` 来进行区分。</span><br><span class="line">*/</span><br><span class="line">+ (BootingProtectionStatus)bootingProtectionStatusWithContext:(NSString *)context continuousCrashOnLaunchNeedToFix:(NSUInteger)continuousCrashOnLaunchNeedToFix &#123;</span><br><span class="line">   </span><br><span class="line">   BOOL isNormalChecking = [self isNormalCheckingWithContext:context];</span><br><span class="line">   if (isNormalChecking) &#123;</span><br><span class="line">       return BootingProtectionStatusNormalChecking;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   BOOL isUpToBootingProtectionCount = [self isUpToBootingProtectionCountWithContext:context</span><br><span class="line">                                                    continuousCrashOnLaunchNeedToFix:continuousCrashOnLaunchNeedToFix];</span><br><span class="line">   if (!isUpToBootingProtectionCount) &#123;</span><br><span class="line">       return BootingProtectionStatusNormal;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   BootingProtectionStatus type;</span><br><span class="line">   BOOL isFixingCrash = [self isFixingCrashWithContext:context];</span><br><span class="line">   if (isFixingCrash) &#123;</span><br><span class="line">       type = BootingProtectionStatusFixing;</span><br><span class="line">   &#125; else &#123;</span><br><span class="line">       type = BootingProtectionStatusNeedFix;</span><br><span class="line">   &#125;</span><br><span class="line">   return type;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (NSUInteger)crashCount &#123;</span><br><span class="line">   return [[self class] crashCountWithContext:_context];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)setCrashCount:(NSInteger)count &#123;</span><br><span class="line">   if (count &gt;=0) &#123;</span><br><span class="line">       [[self class] setCrashCount:count context:_context];</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)setIsFixing:(BOOL)isFixingCrash &#123;</span><br><span class="line">   [[self class] setIsFixing:isFixingCrash context:_context];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/*!</span><br><span class="line">* 是否正在修复</span><br><span class="line">*/</span><br><span class="line">- (BOOL)isFixingCrash &#123;</span><br><span class="line">   return [[self class] isFixingCrashWithContext:_context];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)setIsNormalChecking:(BOOL)isNormalChecking &#123;</span><br><span class="line">   [[self class] setIsNormalChecking:isNormalChecking context:_context];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/*!</span><br><span class="line">* 是否正在检查</span><br><span class="line">*/</span><br><span class="line">- (BOOL)isNormalChecking &#123;</span><br><span class="line">   return [[self class] isNormalCheckingWithContext:_context];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (NSUInteger)crashCountWithContext:(NSString *)context &#123;</span><br><span class="line">   NSString *continuousCrashOnLaunchCounterKey = [self continuousCrashOnLaunchCounterKeyWithContext:context];</span><br><span class="line">   NSUInteger crashCount = [[NSUserDefaults standardUserDefaults] integerForKey:continuousCrashOnLaunchCounterKey];</span><br><span class="line">   NSString *logString = [NSString stringWithFormat:@&quot;crashCount:%@&quot;, @(crashCount)];</span><br><span class="line">   [[self class] Logger:logString];</span><br><span class="line">   return crashCount;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (void)setCrashCount:(NSUInteger)count context:(NSString *)context &#123;</span><br><span class="line">   NSString *continuousCrashOnLaunchCounterKey = [self continuousCrashOnLaunchCounterKeyWithContext:context];</span><br><span class="line">   NSString *logString = [NSString stringWithFormat:@&quot;setCrashCount:%@&quot;, @(count)];</span><br><span class="line">   [[self class] Logger:logString];</span><br><span class="line">   NSUserDefaults *defaults = [NSUserDefaults standardUserDefaults];</span><br><span class="line">   [defaults setInteger:count forKey:continuousCrashOnLaunchCounterKey];</span><br><span class="line">   [defaults synchronize];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (void)setIsFixing:(BOOL)isFixingCrash context:(NSString *)context &#123;</span><br><span class="line">   NSString *continuousCrashFixingKey = [[self class] continuousCrashFixingKeyWithContext:context];</span><br><span class="line">   NSString *logString = [NSString stringWithFormat:@&quot;setisFixingCrash:&#123;%@&#125;&quot;, @(isFixingCrash)];</span><br><span class="line">   [[self class] Logger:logString];</span><br><span class="line">   NSUserDefaults *defaults = [NSUserDefaults standardUserDefaults];</span><br><span class="line">   [defaults setBool:isFixingCrash forKey:continuousCrashFixingKey];</span><br><span class="line">   [defaults synchronize];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (BOOL)isFixingCrashWithContext:(NSString *)context &#123;</span><br><span class="line">   NSString *continuousCrashFixingKey = [[self class] continuousCrashFixingKeyWithContext:context];</span><br><span class="line">   BOOL isFixingCrash = [[NSUserDefaults standardUserDefaults] boolForKey:continuousCrashFixingKey];</span><br><span class="line">   NSString *logString = [NSString stringWithFormat:@&quot;isFixingCrash:%@&quot;, @(isFixingCrash)];</span><br><span class="line">   [[self class] Logger:logString];</span><br><span class="line">   return isFixingCrash;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (void)setIsNormalChecking:(BOOL)isNormalChecking context:(NSString *)context &#123;</span><br><span class="line">   NSString *continuousCrashNormalCheckingKey = [[self class] continuousCrashNormalCheckingKeyWithContext:context];</span><br><span class="line">   NSString *logString = [NSString stringWithFormat:@&quot;setIsNormalChecking:&#123;%@&#125;&quot;, @(isNormalChecking)];</span><br><span class="line">   [[self class] Logger:logString];</span><br><span class="line">   NSUserDefaults *defaults = [NSUserDefaults standardUserDefaults];</span><br><span class="line">   [defaults setBool:isNormalChecking forKey:continuousCrashNormalCheckingKey];</span><br><span class="line">   [defaults synchronize];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (BOOL)isNormalCheckingWithContext:(NSString *)context &#123;</span><br><span class="line">   NSString *continuousCrashFixingKey = [[self class] continuousCrashNormalCheckingKeyWithContext:context];</span><br><span class="line">   BOOL isFixingCrash = [[NSUserDefaults standardUserDefaults] boolForKey:continuousCrashFixingKey];</span><br><span class="line">   NSString *logString = [NSString stringWithFormat:@&quot;isIsNormalChecking:%@&quot;, @(isFixingCrash)];</span><br><span class="line">   [[self class] Logger:logString];</span><br><span class="line">   return isFixingCrash;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (BOOL)isUpToBootingProtectionCount &#123;</span><br><span class="line">   return [[self class] isUpToBootingProtectionCountWithContext:_context continuousCrashOnLaunchNeedToFix:_continuousCrashOnLaunchNeedToFix];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (BOOL)isUpToBootingProtectionCountWithContext:(NSString *)context continuousCrashOnLaunchNeedToFix:(NSUInteger)continuousCrashOnLaunchNeedToFix &#123;</span><br><span class="line">   BOOL isUpToCount = [self crashCountWithContext:context] &gt;= continuousCrashOnLaunchNeedToFix;</span><br><span class="line">   if (isUpToCount) &#123;</span><br><span class="line">       return YES;</span><br><span class="line">   &#125;</span><br><span class="line">   return NO;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)setReportBlock:(ABSReportBlock)block &#123;</span><br><span class="line">   _reportBlock = block;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)setRepairBlock:(ABSRepairBlock)block &#123;</span><br><span class="line">   _repairBlock = block;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/*!</span><br><span class="line">*  “连续启动崩溃计数”个数，对应的Key</span><br><span class="line">*  默认为 &quot;_CONTINUOUS_CRASH_COUNTER_KEY&quot;</span><br><span class="line">*/</span><br><span class="line">+ (NSString *)continuousCrashOnLaunchCounterKeyWithContext:(NSString *)context &#123;</span><br><span class="line">   BOOL isValid = [[self class] isValidString:context];</span><br><span class="line">   NSString *validContext = isValid ? context : @&quot;&quot;;</span><br><span class="line">   NSString *continuousCrashOnLaunchCounterKey = [NSString stringWithFormat:@&quot;%@_CONTINUOUS_CRASH_COUNTER_KEY&quot;, validContext];</span><br><span class="line">   return continuousCrashOnLaunchCounterKey;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/*!</span><br><span class="line">*  是否正在修复记录，对应的Key</span><br><span class="line">*  默认为 &quot;_CONTINUOUS_CRASH_FIXING_KEY&quot;</span><br><span class="line">*/</span><br><span class="line">+ (NSString *)continuousCrashFixingKeyWithContext:(NSString *)context &#123;</span><br><span class="line">   BOOL isValid = [[self class] isValidString:context];</span><br><span class="line">   NSString *validContext = isValid ? context : @&quot;&quot;;</span><br><span class="line">   NSString *continuousCrashFixingKey = [NSString stringWithFormat:@&quot;%@_CONTINUOUS_CRASH_FIXING_KEY&quot;, validContext];</span><br><span class="line">   return continuousCrashFixingKey;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/*!</span><br><span class="line">*  是否正在检查是否在特定时间内会Crash，对应的Key</span><br><span class="line">*  默认为 &quot;_CONTINUOUS_CRASH_CHECKING_KEY&quot;</span><br><span class="line">*/</span><br><span class="line">+ (NSString *)continuousCrashNormalCheckingKeyWithContext:(NSString *)context &#123;</span><br><span class="line">   BOOL isValid = [[self class] isValidString:context];</span><br><span class="line">   NSString *validContext = isValid ? context : @&quot;&quot;;</span><br><span class="line">   NSString *continuousCrashFixingKey = [NSString stringWithFormat:@&quot;%@_CONTINUOUS_CRASH_CHECKING_KEY&quot;, validContext];</span><br><span class="line">   return continuousCrashFixingKey;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark -</span><br><span class="line">#pragma mark - log and util Methods</span><br><span class="line"></span><br><span class="line">+ (void)setLogger:(void (^)(NSString *))logger &#123;</span><br><span class="line">   Logger = [logger copy];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (void)Logger:(NSString *)log &#123;</span><br><span class="line">   if (Logger) Logger(log);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (BOOL)isValidString:(id)notValidString &#123;</span><br><span class="line">   if (!notValidString) &#123;</span><br><span class="line">       return NO;</span><br><span class="line">   &#125;</span><br><span class="line">   if (![notValidString isKindOfClass:[NSString class]]) &#123;</span><br><span class="line">       return NO;</span><br><span class="line">   &#125;</span><br><span class="line">   NSInteger stringLength = 0;</span><br><span class="line">   @try &#123;</span><br><span class="line">       stringLength = [notValidString length];</span><br><span class="line">   &#125; @catch (NSException *exception) &#123;&#125;</span><br><span class="line">   if (stringLength == 0) &#123;</span><br><span class="line">       return NO;</span><br><span class="line">   &#125;</span><br><span class="line">   return YES;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>

<p>下面是相应的验证步骤：</p>
<p>等待15秒会有对应计数清零的操作日志输出：</p>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">2018-01-18 16:25:37.162980+0800 BootingProtection[89773:15553277] 🔴类名与方法名：-[AppDelegate onBeforeBootingProtection]_block_invoke（在第45行），描述：CYLBootingProtection: Launch continuous crash report</span><br><span class="line">2018-01-18 16:25:37.163140+0800 BootingProtection[89773:15553277] 🔴类名与方法名：-[AppDelegate onBeforeBootingProtection]_block_invoke（在第45行），描述：setIsNormalChecking:&#123;0&#125;</span><br><span class="line">2018-01-18 16:25:37.165738+0800 BootingProtection[89773:15553277] 🔴类名与方法名：-[AppDelegate onBeforeBootingProtection]_block_invoke（在第45行），描述：setisFixingCrash:&#123;0&#125;</span><br><span class="line">2018-01-18 16:25:37.166883+0800 BootingProtection[89773:15553277] 🔴类名与方法名：-[AppDelegate onBeforeBootingProtection]_block_invoke（在第45行），描述：crashCount:0</span><br><span class="line">2018-01-18 16:25:37.167102+0800 BootingProtection[89773:15553277] 🔴类名与方法名：-[AppDelegate onBeforeBootingProtection]_block_invoke（在第45行），描述：crashCount:0</span><br><span class="line">2018-01-18 16:25:37.167253+0800 BootingProtection[89773:15553277] 🔴类名与方法名：-[AppDelegate onBeforeBootingProtection]_block_invoke（在第45行），描述：setIsNormalChecking:&#123;1&#125;</span><br><span class="line">2018-01-18 16:25:37.167938+0800 BootingProtection[89773:15553277] 🔴类名与方法名：-[AppDelegate onBeforeBootingProtection]_block_invoke（在第45行），描述：setCrashCount:1</span><br><span class="line">2018-01-18 16:25:37.168806+0800 BootingProtection[89773:15553277] 🔴类名与方法名：-[AppDelegate onBeforeBootingProtection]_block_invoke（在第45行），描述：need no repair</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2018-01-18 16:25:52.225197+0800 BootingProtection[89773:15553277] 🔴类名与方法名：-[AppDelegate onBeforeBootingProtection]_block_invoke（在第45行），描述：CYLBootingProtection: long live the app ( more than 15 seconds ), now reset crash counts</span><br><span class="line">2018-01-18 16:25:52.225378+0800 BootingProtection[89773:15553277] 🔴类名与方法名：-[AppDelegate onBeforeBootingProtection]_block_invoke（在第45行），描述：setCrashCount:0</span><br><span class="line">2018-01-18 16:25:52.226234+0800 BootingProtection[89773:15553277] 🔴类名与方法名：-[AppDelegate onBeforeBootingProtection]_block_invoke（在第45行），描述：setIsNormalChecking:&#123;0&#125;</span><br><span class="line">2018-01-18 16:25:52.226595+0800 BootingProtection[89773:15553277] 🔴类名与方法名：-[AppDelegate onBeforeBootingProtection]_block_invoke（在第45行），描述：setisFixingCrash:&#123;0&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p>Posted by <a href="http://weibo.com/luohanchenyilong/" target="_blank" rel="noopener">微博@iOS程序犭袁</a><br>原创文章，版权声明：自由转载-非商用-非衍生-保持署名 | <a href="http://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh" target="_blank" rel="noopener">Creative Commons BY-NC-ND 3.0</a></p>
<p align="center"><a href="http://weibo.com/u/1692391497?s=6uyXnP" target="_blank"><img border="0" src="http://service.t.sina.com.cn/widget/qmd/1692391497/b46c844b/1.png"></a></p>
        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-image">
        <a href="/2017/09/06/GCD-Global/" class="image is-7by1">
            <img class="thumbnail" src="https://www.policx.com/talk/images/denglu.jpg" alt="避免使用 GCD Global队列创建Runloop常驻线程">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-09-06T11:30:00.000Z">2017-09-06</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/programing/">programing</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    20 分钟 读完 (大约 3012 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/09/06/GCD-Global/">避免使用 GCD Global队列创建Runloop常驻线程</a>
            
        </h1>
        <div class="content">
            <h1 id="避免使用-GCD-Global队列创建Runloop常驻线程"><a href="#避免使用-GCD-Global队列创建Runloop常驻线程" class="headerlink" title="避免使用 GCD Global队列创建Runloop常驻线程"></a>避免使用 GCD Global队列创建Runloop常驻线程</h1><p>本文对应 Demo 以及 Markdown 文件在<a href="https://github.com/ChenYilong/iOSBlog/tree/master/Tips/避免使用GCD-Global队列创建Runloop常驻线程" target="_blank" rel="noopener">仓库中</a>，文中的错误可以提 PR 到这个文件，我会及时更改。</p>
<h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->

<ul>
<li><a href="#%E9%81%BF%E5%85%8D%E4%BD%BF%E7%94%A8-gcd-global%E9%98%9F%E5%88%97%E5%88%9B%E5%BB%BArunloop%E5%B8%B8%E9%A9%BB%E7%BA%BF%E7%A8%8B">避免使用 GCD Global队列创建Runloop常驻线程</a><ul>
<li><a href="#gcd-global%E9%98%9F%E5%88%97%E5%88%9B%E5%BB%BA%E7%BA%BF%E7%A8%8B%E8%BF%9B%E8%A1%8C%E8%80%97%E6%97%B6%E6%93%8D%E4%BD%9C%E7%9A%84%E9%A3%8E%E9%99%A9">GCD Global队列创建线程进行耗时操作的风险</a></li>
<li><a href="#%E9%81%BF%E5%85%8D%E4%BD%BF%E7%94%A8-gcd-global-%E9%98%9F%E5%88%97%E5%88%9B%E5%BB%BA-runloop-%E5%B8%B8%E9%A9%BB%E7%BA%BF%E7%A8%8B">避免使用 GCD Global 队列创建 Runloop 常驻线程</a><ul>
<li><a href="#%E5%8D%95%E4%B8%80-runloop-%E5%B8%B8%E9%A9%BB%E7%BA%BF%E7%A8%8B">单一 Runloop 常驻线程</a></li>
<li><a href="#%E5%A4%9A%E4%B8%AA-runloop-%E5%B8%B8%E9%A9%BB%E7%BA%BF%E7%A8%8B">多个 Runloop 常驻线程</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- END doctoc generated TOC please keep comment here to allow auto update -->


<h2 id="GCD-Global队列创建线程进行耗时操作的风险"><a href="#GCD-Global队列创建线程进行耗时操作的风险" class="headerlink" title="GCD Global队列创建线程进行耗时操作的风险"></a>GCD Global队列创建线程进行耗时操作的风险</h2><p>先思考下如下几个问题：</p>
<ul>
<li>新建线程的方式有哪些？各自的优缺点是什么？</li>
<li>dispatch_async 函数分发到全局队列一定会新建线程执行任务么？</li>
<li>如果全局队列对应的线程池如果满了，后续的派发的任务会怎么处置？有什么风险？</li>
</ul>
<p>答案大致是这样的：dispatch_async 函数分发到全局队列不一定会新建线程执行任务，全局队列底层有一个的线程池，如果线程池满了，那么后续的任务会被 block 住，等待前面的任务执行完成，才会继续执行。如果线程池中的线程长时间不结束，后续堆积的任务会越来越多，此时就会存在 APP crash的风险。</p>
<p> 比如：</p>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">- (void)dispatchTest1 &#123;</span><br><span class="line">    for (NSInteger i = 0; i&lt; 10000 ; i++) &#123;</span><br><span class="line">dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^&#123;</span><br><span class="line">            [self dispatchTask:i];</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)dispatchTask:(NSInteger)index &#123;</span><br><span class="line">        //模拟耗时操作，比如DB,网络，文件读写等等</span><br><span class="line">        sleep(30);</span><br><span class="line">        NSLog(@&quot;----:%ld&quot;,index);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以上逻辑用真机测试会有卡死的几率，并非每次都会发生，但多尝试几次就会复现，伴随前后台切换，crash几率增大。</p>
<p>下面做一下分析：</p>
<p>参看 GCD 源码我们可以看到全局队列的相关源码如下：</p>
 <figure class="highlight c hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"> DISPATCH_NOINLINE</span><br><span class="line"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span></span><br><span class="line">_dispatch_queue_wakeup_global_slow(<span class="hljs-keyword">dispatch_queue_t</span> dq, <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> n)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="hljs-keyword">dispatch_root_queue_context_t</span> qc = dq-&gt;do_ctxt;</span><br><span class="line">	<span class="hljs-keyword">uint32_t</span> i = n;</span><br><span class="line">	<span class="hljs-keyword">int</span> r;</span><br><span class="line"></span><br><span class="line">	_dispatch_debug_root_queue(dq, __func__);</span><br><span class="line">	dispatch_once_f(&amp;_dispatch_root_queues_pred, <span class="hljs-literal">NULL</span>,</span><br><span class="line">			_dispatch_root_queues_init);</span><br><span class="line"></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> HAVE_PTHREAD_WORKQUEUES</span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> DISPATCH_USE_PTHREAD_POOL</span></span><br><span class="line">	<span class="hljs-keyword">if</span> (qc-&gt;dgq_kworkqueue != (<span class="hljs-keyword">void</span>*)(~<span class="hljs-number">0u</span>l))</span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span></span><br><span class="line">	&#123;</span><br><span class="line">		_dispatch_root_queue_debug(<span class="hljs-string">"requesting new worker thread for global "</span></span><br><span class="line">				<span class="hljs-string">"queue: %p"</span>, dq);</span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> DISPATCH_USE_LEGACY_WORKQUEUE_FALLBACK</span></span><br><span class="line">		<span class="hljs-keyword">if</span> (qc-&gt;dgq_kworkqueue) &#123;</span><br><span class="line">			<span class="hljs-keyword">pthread_workitem_handle_t</span> wh;</span><br><span class="line">			<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> gen_cnt;</span><br><span class="line">			<span class="hljs-keyword">do</span> &#123;</span><br><span class="line">				r = pthread_workqueue_additem_np(qc-&gt;dgq_kworkqueue,</span><br><span class="line">						_dispatch_worker_thread4, dq, &amp;wh, &amp;gen_cnt);</span><br><span class="line">				(<span class="hljs-keyword">void</span>)dispatch_assume_zero(r);</span><br><span class="line">			&#125; <span class="hljs-keyword">while</span> (--i);</span><br><span class="line">			<span class="hljs-keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span> <span class="hljs-comment">// DISPATCH_USE_LEGACY_WORKQUEUE_FALLBACK</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> HAVE_PTHREAD_WORKQUEUE_SETDISPATCH_NP</span></span><br><span class="line">		<span class="hljs-keyword">if</span> (!dq-&gt;dq_priority) &#123;</span><br><span class="line">			r = pthread_workqueue_addthreads_np(qc-&gt;dgq_wq_priority,</span><br><span class="line">					qc-&gt;dgq_wq_options, (<span class="hljs-keyword">int</span>)i);</span><br><span class="line">			(<span class="hljs-keyword">void</span>)dispatch_assume_zero(r);</span><br><span class="line">			<span class="hljs-keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> HAVE_PTHREAD_WORKQUEUE_QOS</span></span><br><span class="line">		r = _pthread_workqueue_addthreads((<span class="hljs-keyword">int</span>)i, dq-&gt;dq_priority);</span><br><span class="line">		(<span class="hljs-keyword">void</span>)dispatch_assume_zero(r);</span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span></span><br><span class="line">		<span class="hljs-keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span> <span class="hljs-comment">// HAVE_PTHREAD_WORKQUEUES</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> DISPATCH_USE_PTHREAD_POOL</span></span><br><span class="line">	<span class="hljs-keyword">dispatch_pthread_root_queue_context_t</span> pqc = qc-&gt;dgq_ctxt;</span><br><span class="line">	<span class="hljs-keyword">if</span> (fastpath(pqc-&gt;dpq_thread_mediator.do_vtable)) &#123;</span><br><span class="line">		<span class="hljs-keyword">while</span> (dispatch_semaphore_signal(&amp;pqc-&gt;dpq_thread_mediator)) &#123;</span><br><span class="line">			<span class="hljs-keyword">if</span> (!--i) &#123;</span><br><span class="line">				<span class="hljs-keyword">return</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="hljs-keyword">uint32_t</span> j, t_count;</span><br><span class="line">	<span class="hljs-comment">// seq_cst with atomic store to tail &lt;rdar://problem/16932833&gt;</span></span><br><span class="line">	t_count = dispatch_atomic_load2o(qc, dgq_thread_pool_size, seq_cst);</span><br><span class="line">	<span class="hljs-keyword">do</span> &#123;</span><br><span class="line">		<span class="hljs-keyword">if</span> (!t_count) &#123;</span><br><span class="line">			_dispatch_root_queue_debug(<span class="hljs-string">"pthread pool is full for root queue: "</span></span><br><span class="line">					<span class="hljs-string">"%p"</span>, dq);</span><br><span class="line">			<span class="hljs-keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		j = i &gt; t_count ? t_count : i;</span><br><span class="line">	&#125; <span class="hljs-keyword">while</span> (!dispatch_atomic_cmpxchgvw2o(qc, dgq_thread_pool_size, t_count,</span><br><span class="line">			t_count - j, &amp;t_count, acquire));</span><br><span class="line"></span><br><span class="line">	<span class="hljs-keyword">pthread_attr_t</span> *attr = &amp;pqc-&gt;dpq_thread_attr;</span><br><span class="line">	<span class="hljs-keyword">pthread_t</span> tid, *pthr = &amp;tid;</span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> DISPATCH_ENABLE_PTHREAD_ROOT_QUEUES</span></span><br><span class="line">	<span class="hljs-keyword">if</span> (slowpath(dq == &amp;_dispatch_mgr_root_queue)) &#123;</span><br><span class="line">		pthr = _dispatch_mgr_root_queue_init();</span><br><span class="line">	&#125;</span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span></span><br><span class="line">	<span class="hljs-keyword">do</span> &#123;</span><br><span class="line">		_dispatch_retain(dq);</span><br><span class="line">		<span class="hljs-keyword">while</span> ((r = pthread_create(pthr, attr, _dispatch_worker_thread, dq))) &#123;</span><br><span class="line">			<span class="hljs-keyword">if</span> (r != EAGAIN) &#123;</span><br><span class="line">				(<span class="hljs-keyword">void</span>)dispatch_assume_zero(r);</span><br><span class="line">			&#125;</span><br><span class="line">			_dispatch_temporary_resource_shortage();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="hljs-keyword">while</span> (--j);</span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span> <span class="hljs-comment">// DISPATCH_USE_PTHREAD_POOL</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>对于执行的任务来说，所执行的线程具体是哪个线程，则是通过 GCD 的线程池（Thread Pool）来进行调度，正如<a href="https://www.objc.io/issues/2-concurrency/concurrency-apis-and-pitfalls/" target="_blank" rel="noopener">Concurrent Programming: APIs and Challenges</a>文章里给的示意图所示：</p>
<p><img src="https://ww3.sinaimg.cn/large/006tNbRwly1fghg0f8vb6j30yw0k6wep.jpg" alt></p>
<p>上面贴的源码，我们关注如下的部分：</p>
<p>其中有一个用来记录线程池大小的字段 <code>dgq_thread_pool_size</code>。这个字段标记着GCD线程池的大小。摘录上面源码的一部分：</p>
  <figure class="highlight c hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> <span class="hljs-keyword">uint32_t</span> j, t_count;</span><br><span class="line"><span class="hljs-comment">// seq_cst with atomic store to tail &lt;rdar://problem/16932833&gt;</span></span><br><span class="line">t_count = dispatch_atomic_load2o(qc, dgq_thread_pool_size, seq_cst);</span><br><span class="line"><span class="hljs-keyword">do</span> &#123;</span><br><span class="line">	<span class="hljs-keyword">if</span> (!t_count) &#123;</span><br><span class="line">		_dispatch_root_queue_debug(<span class="hljs-string">"pthread pool is full for root queue: "</span></span><br><span class="line">				<span class="hljs-string">"%p"</span>, dq);</span><br><span class="line">		<span class="hljs-keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	j = i &gt; t_count ? t_count : i;</span><br><span class="line">&#125; <span class="hljs-keyword">while</span> (!dispatch_atomic_cmpxchgvw2o(qc, dgq_thread_pool_size, t_count,</span><br><span class="line">		t_count - j, &amp;t_count, acquire));</span><br></pre></td></tr></table></figure>

<p>从源码中我们可以对应到<a href="https://developer.apple.com/library/content/documentation/General/Conceptual/ConcurrencyProgrammingGuide/OperationQueues/OperationQueues.html#//apple_ref/doc/uid/TP40008091-CH102-SW5" target="_blank" rel="noopener">官方文档 ：Getting the Global Concurrent Dispatch Queues</a>里的说法：</p>
<blockquote>
<p>A concurrent dispatch queue is useful when you have multiple tasks that can run in parallel. A concurrent queue is still a queue in that it dequeues tasks in a first-in, first-out order; however, a concurrent queue may dequeue additional tasks before any previous tasks finish. The actual number of tasks executed by a concurrent queue at any given moment is variable and can change dynamically as conditions in your application change. Many factors affect the number of tasks executed by the concurrent queues, including the number of available cores, the amount of work being done by other processes, and the number and priority of tasks in other serial dispatch queues.</p>
</blockquote>
<p>也就是说：</p>
<p>全局队列的底层是一个线程池，向全局队列中提交的 block，都会被放到这个线程池中执行，如果线程池已满，后续再提交 block 就不会再重新创建线程。这就是为什么 Demo 会造成卡顿甚至冻屏的原因。</p>
<h2 id="避免使用-GCD-Global-队列创建-Runloop-常驻线程"><a href="#避免使用-GCD-Global-队列创建-Runloop-常驻线程" class="headerlink" title="避免使用 GCD Global 队列创建 Runloop 常驻线程"></a>避免使用 GCD Global 队列创建 Runloop 常驻线程</h2><p>在做网路请求时我们常常创建一个 Runloop 常驻线程用来接收、响应后续的服务端回执，比如NSURLConnection、AFNetworking等等，我们可以称这种线程为 Runloop 常驻线程。</p>
<p>正如上文所述，用 GCD Global 队列创建线程进行耗时操作是存在风险的。那么我们可以试想下，如果这个耗时操作变成了 runloop 常驻线程，会是什么结果？下面做一下分析：</p>
<p>先介绍下 Runloop 常驻线程的原理，在开发中一般有两种用法：</p>
<ul>
<li>单一 Runloop 常驻线程：在 APP 的生命周期中开启了唯一的常驻线程来进行网络请求，常用于网络库，或者有维持长连接需求的库，比如： AFNetworking 、 <a href="https://github.com/facebook/SocketRocket" target="_blank" rel="noopener">SocketRocket</a>。</li>
<li>多个 Runloop 常驻线程：每进行一次网络请求就开启一条 Runloop 常驻线程，这条线程的生命周期的起点是网络请求开始，终点是网络请求结束，或者网络请求超时。</li>
</ul>
<h3 id="单一-Runloop-常驻线程"><a href="#单一-Runloop-常驻线程" class="headerlink" title="单一 Runloop 常驻线程"></a>单一 Runloop 常驻线程</h3><p>先说第一种用法：</p>
<p>以 AFNetworking 为例，<a href="https://github.com/AFNetworking/AFNetworking/blob/master/AFNetworking%2FAFURLConnectionOperation.m" target="_blank" rel="noopener">AFURLConnectionOperation</a> 这个类是基于 NSURLConnection 构建的，其希望能在后台线程接收 Delegate 回调。为此 AFNetworking 单独创建了一个线程，并在这个线程中启动了一个 RunLoop：</p>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">+ (void)networkRequestThreadEntryPoint:(id)__unused object &#123;</span><br><span class="line">    @autoreleasepool &#123;</span><br><span class="line">        [[NSThread currentThread] setName:@&quot;AFNetworking&quot;];</span><br><span class="line">        NSRunLoop *runLoop = [NSRunLoop currentRunLoop];</span><br><span class="line">        [runLoop addPort:[NSMachPort port] forMode:NSDefaultRunLoopMode];</span><br><span class="line">        [runLoop run];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">+ (NSThread *)networkRequestThread &#123;</span><br><span class="line">    static NSThread *_networkRequestThread = nil;</span><br><span class="line">    static dispatch_once_t oncePredicate;</span><br><span class="line">    dispatch_once(&amp;oncePredicate, ^&#123;</span><br><span class="line">        _networkRequestThread = [[NSThread alloc] initWithTarget:self selector:@selector(networkRequestThreadEntryPoint:) object:nil];</span><br><span class="line">        [_networkRequestThread start];</span><br><span class="line">    &#125;);</span><br><span class="line">    return _networkRequestThread;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="多个-Runloop-常驻线程"><a href="#多个-Runloop-常驻线程" class="headerlink" title="多个 Runloop 常驻线程"></a>多个 Runloop 常驻线程</h3><p>第二种用法，我写了一个小 Demo 来模拟这种场景，</p>
<p>我们模拟了一个场景：假设所有的网络请求全部超时，或者服务端根本不响应，然后网络库超时检测机制的做法：</p>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;Foo.h&quot;</span><br><span class="line"></span><br><span class="line">@interface Foo()  &#123;</span><br><span class="line">    NSRunLoop *_runloop;</span><br><span class="line">    NSTimer *_timeoutTimer;</span><br><span class="line">    NSTimeInterval _timeoutInterval;</span><br><span class="line">    dispatch_semaphore_t _sem;</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation Foo</span><br><span class="line"></span><br><span class="line">- (instancetype)init &#123;</span><br><span class="line">    if (!(self = [super init])) &#123;</span><br><span class="line">        return nil;</span><br><span class="line">    &#125;</span><br><span class="line">    _timeoutInterval = 1 ;</span><br><span class="line">    _sem = dispatch_semaphore_create(0);</span><br><span class="line">    // Do any additional setup after loading the view, typically from a nib.</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (id)test &#123;</span><br><span class="line">    // 第一种方式：</span><br><span class="line">    // NSThread *networkRequestThread = [[NSThread alloc] initWithTarget:self selector:@selector(networkRequestThreadEntryPoint0:) object:nil];</span><br><span class="line">    // [networkRequestThread start];</span><br><span class="line">    //第二种方式:</span><br><span class="line">    dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^(void) &#123;</span><br><span class="line">        [self networkRequestThreadEntryPoint0:nil];</span><br><span class="line">    &#125;);</span><br><span class="line">    dispatch_semaphore_wait(_sem, DISPATCH_TIME_FOREVER);</span><br><span class="line">    return @(YES);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)networkRequestThreadEntryPoint0:(id)__unused object &#123;</span><br><span class="line">    @autoreleasepool &#123;</span><br><span class="line">        [[NSThread currentThread] setName:@&quot;CYLTest&quot;];</span><br><span class="line">        _runloop = [NSRunLoop currentRunLoop];</span><br><span class="line">        [_runloop addPort:[NSMachPort port] forMode:NSDefaultRunLoopMode];</span><br><span class="line">        _timeoutTimer = [NSTimer scheduledTimerWithTimeInterval:1 target:self selector:@selector(stopLoop) userInfo:nil repeats:NO];</span><br><span class="line">        [_runloop addTimer:_timeoutTimer forMode:NSRunLoopCommonModes];</span><br><span class="line">        [_runloop run];//在实际开发中最好使用这种方式来确保能runloop退出，做双重的保障[runloop runUntilDate:[NSDate dateWithTimeIntervalSinceNow:(timeoutInterval+5)]];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)stopLoop &#123;</span><br><span class="line">    CFRunLoopStop([_runloop getCFRunLoop]);</span><br><span class="line">    dispatch_semaphore_signal(_sem);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>

<p>如果 </p>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">for (int i = 0; i &lt; 300 ; i++) &#123;</span><br><span class="line">     dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^(void) &#123;</span><br><span class="line">         [[Foo new] test];</span><br><span class="line">         NSLog(@&quot;🔴类名与方法名：%@（在第%@行），描述：%@&quot;, @(__PRETTY_FUNCTION__), @(__LINE__), @&quot;&quot;);</span><br><span class="line">     &#125;);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>以上逻辑用真机测试会有卡死的几率，并非每次都会发生，但多尝试几次就会复现，伴随前后台切换，crash几率增大。</p>
<p>其中我们采用了 GCD 全局队列的方式来创建常驻线程，因为在创建时可能已经出现了全局队列的线程池满了的情况，所以 GCD 派发的任务，无法执行，而且我们把超时检测的逻辑放进了这个任务中，所以导致的情况就是，有很多任务的超时检测功能失效了。此时就只能依赖于服务端响应来结束该任务（服务端响应能结束该任务的逻辑在 Demo 中未给出），但是如果再加之服务端不响应，那么任务就永远不会结束。后续的网络请求也会就此 block 住，造成 crash。</p>
<p>如果我们把 GCD 全局队列换成 NSThread 的方式，那么就可以保证每次都会创建新的线程。</p>
<p>注意：文章中只演示的是超时 cancel runloop 的操作，实际项目中一定有其他主动 cancel runloop 的操作，就比如网络请求成功或失败后需要进行cancel操作。代码中没有展示网络请求成功或失败后的 cancel 操作。</p>
<p>Demo 的这种模拟可能比较极端，但是如果你维护的是一个像 AFNetworking 这样的一个网络库，你会放心把创建常驻线程这样的操作交给 GCD 全局队列吗？因为整个 APP 是在共享一个全局队列的线程池，那么如果 APP 把线程池沾满了，甚至线程池长时间占满且不结束，那么 AFNetworking 就自然不能再执行任务了，所以我们看到，即使是只会创建一条常驻线程， AFNetworking 依然采用了 NSThread 的方式而非  GCD 全局队列这种方式。</p>
<p>注释：以下方法存在于老版本<a href="https://github.com/AFNetworking/AFNetworking/tree/2.x" target="_blank" rel="noopener">AFN 2.x</a> 中。</p>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">+ (void)networkRequestThreadEntryPoint:(id)__unused object &#123;</span><br><span class="line">    @autoreleasepool &#123;</span><br><span class="line">        [[NSThread currentThread] setName:@&quot;AFNetworking&quot;];</span><br><span class="line">        NSRunLoop *runLoop = [NSRunLoop currentRunLoop];</span><br><span class="line">        [runLoop addPort:[NSMachPort port] forMode:NSDefaultRunLoopMode];</span><br><span class="line">        [runLoop run];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">+ (NSThread *)networkRequestThread &#123;</span><br><span class="line">    static NSThread *_networkRequestThread = nil;</span><br><span class="line">    static dispatch_once_t oncePredicate;</span><br><span class="line">    dispatch_once(&amp;oncePredicate, ^&#123;</span><br><span class="line">        _networkRequestThread = [[NSThread alloc] initWithTarget:self selector:@selector(networkRequestThreadEntryPoint:) object:nil];</span><br><span class="line">        [_networkRequestThread start];</span><br><span class="line">    &#125;);</span><br><span class="line">    return _networkRequestThread;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>正如你所看到的，没有任何一个库会用 GCD 全局队列来创建常驻线程，而你也应该</p>
<blockquote>
<p>避免使用 GCD Global 队列来创建 Runloop 常驻线程。</p>
</blockquote>
<!-- 最后的错误示例，如果发生在线上，如果遭遇服务端频繁不响应或超时，那么六七万日活APP，三天能有十个左右crash。150万日活APP，一周60个左右crash。 -->

<hr>
<p>Posted by <a href="http://weibo.com/luohanchenyilong/" target="_blank" rel="noopener">微博@iOS程序犭袁</a><br>原创文章，版权声明：自由转载-非商用-非衍生-保持署名 | <a href="http://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh" target="_blank" rel="noopener">Creative Commons BY-NC-ND 3.0</a></p>
<p align="center"><a href="http://weibo.com/u/1692391497?s=6uyXnP" target="_blank"><img border="0" src="http://service.t.sina.com.cn/widget/qmd/1692391497/b46c844b/1.png"></a></p>
        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-image">
        <a href="/2017/08/25/RxSwift/" class="image is-7by1">
            <img class="thumbnail" src="https://gss2.bdstatic.com/9fo3dSag_xI4khGkpoWK1HF6hhy/baike/w%3D268%3Bg%3D0/sign=ef305e5a4510b912bfc1f1f8fbc69b3e/500fd9f9d72a6059070cf8fb2a34349b033bba36.jpg" alt="什么是RxSwift">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-08-25T12:32:36.000Z">2017-08-25</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/programing/">programing</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    31 分钟 读完 (大约 4626 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/08/25/RxSwift/">什么是RxSwift</a>
            
        </h1>
        <div class="content">
            <p>相信大家很早就听说过函数式响应编程概念，我是去年面试的时候接触到函数式响应编程的，当时也是第一次接触到MVVM这个概念，转眼都一年过去了，我却没有在函数式编程上做深入的研究，说来还真是惭愧。<br>不过最近由于想要使用RxSwift，所以趁这个时候好好接触和研究一下传说中的函数式编程，由于网上关于RxSwift的教程资料很少，这篇文章其实就是最RxSwift官方文档和一些概念做一些解读。算是大家学习的参考文章吧！ 先挖个坑，这可能会是一个RxSwift系列，希望大家在学习的时候有所参考。</p>
        </div>
        
        
        <div class="level is-mobile">
            <div class="level-start">
                <div class="level-item">
                <a class="button is-size-7 is-light" href="/2017/08/25/RxSwift/#more">阅读更多</a>
                </div>
            </div>
        </div>
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-image">
        <a href="/2017/01/17/iosyoumeng/" class="image is-7by1">
            <img class="thumbnail" src="https://images.pexels.com/photos/546819/pexels-photo-546819.jpeg?auto=format%2Ccompress&amp;cs=tinysrgb&amp;dpr=2&amp;w=500" alt="iOS 友盟分享笔记">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-01-16T18:30:36.000Z">2017-01-17</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/programing/">programing</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    6 分钟 读完 (大约 911 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/01/17/iosyoumeng/">iOS 友盟分享笔记</a>
            
        </h1>
        <div class="content">
            <h4 id="1-下载友盟分享SDK"><a href="#1-下载友盟分享SDK" class="headerlink" title="1.下载友盟分享SDK"></a>1.下载友盟分享SDK</h4><h4 id="2-将-UMSocial-文件拖入工程-注-根据你需要分享的平台来添加，UMSocial-gt-SocialLibraries-删除你不需要的平台，否则很占包体积-比如我只需要-QQ，Sina，WeChat"><a href="#2-将-UMSocial-文件拖入工程-注-根据你需要分享的平台来添加，UMSocial-gt-SocialLibraries-删除你不需要的平台，否则很占包体积-比如我只需要-QQ，Sina，WeChat" class="headerlink" title="2.将 UMSocial 文件拖入工程 (注:根据你需要分享的平台来添加，UMSocial -&gt; SocialLibraries 删除你不需要的平台，否则很占包体积,比如我只需要 QQ，Sina，WeChat)"></a>2.将 UMSocial 文件拖入工程 (注:根据你需要分享的平台来添加，UMSocial -&gt; SocialLibraries 删除你不需要的平台，否则很占包体积,比如我只需要 QQ，Sina，WeChat)</h4><h4 id="3-添加配置项目-Build-Setting-gt-Lingking-gt-Other-Linker-Flags-ObjC-！！！如果没有设置，所有环境配置好之后，点击分享，UMShareUI-弹出的将没有平台头像"><a href="#3-添加配置项目-Build-Setting-gt-Lingking-gt-Other-Linker-Flags-ObjC-！！！如果没有设置，所有环境配置好之后，点击分享，UMShareUI-弹出的将没有平台头像" class="headerlink" title="3.添加配置项目  Build Setting -&gt; Lingking -&gt; Other Linker Flags  -ObjC  ！！！如果没有设置，所有环境配置好之后，点击分享，UMShareUI 弹出的将没有平台头像"></a>3.添加配置项目  Build Setting -&gt; Lingking -&gt; Other Linker Flags  -ObjC  ！！！如果没有设置，所有环境配置好之后，点击分享，UMShareUI 弹出的将没有平台头像</h4><h5 id="配置依赖库"><a href="#配置依赖库" class="headerlink" title="配置依赖库"></a>配置依赖库</h5> <figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1) SystemConfiguration.framework </span><br><span class="line">    CoreTelephony.framework </span><br><span class="line">    ImageIO.framework </span><br><span class="line">    libsqlite3.tbd </span><br><span class="line">    libz.tbd</span><br><span class="line">    libc++.tbd</span><br></pre></td></tr></table></figure>

<h4 id="4-设置ATS-找到Info-plist-右键，OpenAs-SourceCode-添加一下-分别是，QQ，微信，微博"><a href="#4-设置ATS-找到Info-plist-右键，OpenAs-SourceCode-添加一下-分别是，QQ，微信，微博" class="headerlink" title="4.设置ATS  找到Info.plist   右键，OpenAs SourceCode  添加一下(分别是，QQ，微信，微博)"></a>4.设置ATS  找到Info.plist   右键，OpenAs SourceCode  添加一下(分别是，QQ，微信，微博)</h4><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">&lt;key&gt;NSAppTransportSecurity&lt;/key&gt;</span><br><span class="line">    &lt;dict&gt;</span><br><span class="line">        &lt;key&gt;NSAllowsArbitraryLoads&lt;/key&gt;</span><br><span class="line">        &lt;true/&gt;</span><br><span class="line">        &lt;key&gt;NSExceptionDomains&lt;/key&gt;</span><br><span class="line">        &lt;dict&gt;</span><br><span class="line">            &lt;key&gt;renren.com&lt;/key&gt;</span><br><span class="line">            &lt;dict&gt;</span><br><span class="line">                &lt;key&gt;NSIncludesSubdomains&lt;/key&gt;</span><br><span class="line">                &lt;true/&gt;</span><br><span class="line">                &lt;key&gt;NSThirdPartyExceptionAllowsInsecureHTTPLoads&lt;/key&gt;</span><br><span class="line">                &lt;true/&gt;</span><br><span class="line">                &lt;key&gt;NSThirdPartyExceptionRequiresForwardSecrecy&lt;/key&gt;</span><br><span class="line">                &lt;false/&gt;</span><br><span class="line">            &lt;/dict&gt;</span><br><span class="line">            &lt;key&gt;sina.cn&lt;/key&gt;</span><br><span class="line">            &lt;dict&gt;</span><br><span class="line">                &lt;key&gt;NSExceptionMinimumTLSVersion&lt;/key&gt;</span><br><span class="line">                &lt;string&gt;TLSv1.0&lt;/string&gt;</span><br><span class="line">                &lt;key&gt;NSIncludesSubdomains&lt;/key&gt;</span><br><span class="line">                &lt;true/&gt;</span><br><span class="line">                &lt;key&gt;NSThirdPartyExceptionRequiresForwardSecrecy&lt;/key&gt;</span><br><span class="line">                &lt;false/&gt;</span><br><span class="line">            &lt;/dict&gt;</span><br><span class="line">            &lt;key&gt;sina.com.cn&lt;/key&gt;</span><br><span class="line">            &lt;dict&gt;</span><br><span class="line">                &lt;key&gt;NSIncludesSubdomains&lt;/key&gt;</span><br><span class="line">                &lt;true/&gt;</span><br><span class="line">                &lt;key&gt;NSThirdPartyExceptionAllowsInsecureHTTPLoads&lt;/key&gt;</span><br><span class="line">                &lt;true/&gt;</span><br><span class="line">                &lt;key&gt;NSThirdPartyExceptionRequiresForwardSecrecy&lt;/key&gt;</span><br><span class="line">                &lt;false/&gt;</span><br><span class="line">            &lt;/dict&gt;</span><br><span class="line">            &lt;key&gt;sinaimg.cn&lt;/key&gt;</span><br><span class="line">            &lt;dict&gt;</span><br><span class="line">                &lt;key&gt;NSIncludesSubdomains&lt;/key&gt;</span><br><span class="line">                &lt;true/&gt;</span><br><span class="line">                &lt;key&gt;NSThirdPartyExceptionAllowsInsecureHTTPLoads&lt;/key&gt;</span><br><span class="line">                &lt;true/&gt;</span><br><span class="line">                &lt;key&gt;NSThirdPartyExceptionRequiresForwardSecrecy&lt;/key&gt;</span><br><span class="line">                &lt;false/&gt;</span><br><span class="line">            &lt;/dict&gt;</span><br><span class="line">            &lt;key&gt;sinajs.cn&lt;/key&gt;</span><br><span class="line">            &lt;dict&gt;</span><br><span class="line">                &lt;key&gt;NSIncludesSubdomains&lt;/key&gt;</span><br><span class="line">                &lt;true/&gt;</span><br><span class="line">                &lt;key&gt;NSThirdPartyExceptionAllowsInsecureHTTPLoads&lt;/key&gt;</span><br><span class="line">                &lt;true/&gt;</span><br><span class="line">                &lt;key&gt;NSThirdPartyExceptionRequiresForwardSecrecy&lt;/key&gt;</span><br><span class="line">                &lt;false/&gt;</span><br><span class="line">            &lt;/dict&gt;</span><br><span class="line">            &lt;key&gt;weibo.cn&lt;/key&gt;</span><br><span class="line">            &lt;dict&gt;</span><br><span class="line">                &lt;key&gt;NSExceptionMinimumTLSVersion&lt;/key&gt;</span><br><span class="line">                &lt;string&gt;TLSv1.0&lt;/string&gt;</span><br><span class="line">                &lt;key&gt;NSIncludesSubdomains&lt;/key&gt;</span><br><span class="line">                &lt;true/&gt;</span><br><span class="line">                &lt;key&gt;NSThirdPartyExceptionRequiresForwardSecrecy&lt;/key&gt;</span><br><span class="line">                &lt;false/&gt;</span><br><span class="line">            &lt;/dict&gt;</span><br><span class="line">            &lt;key&gt;weibo.com&lt;/key&gt;</span><br><span class="line">            &lt;dict&gt;</span><br><span class="line">                &lt;key&gt;NSExceptionMinimumTLSVersion&lt;/key&gt;</span><br><span class="line">                &lt;string&gt;TLSv1.0&lt;/string&gt;</span><br><span class="line">                &lt;key&gt;NSIncludesSubdomains&lt;/key&gt;</span><br><span class="line">                &lt;true/&gt;</span><br><span class="line">                &lt;key&gt;NSThirdPartyExceptionAllowsInsecureHTTPLoads&lt;/key&gt;</span><br><span class="line">                &lt;true/&gt;</span><br><span class="line">                &lt;key&gt;NSThirdPartyExceptionRequiresForwardSecrecy&lt;/key&gt;</span><br><span class="line">                &lt;false/&gt;</span><br><span class="line">            &lt;/dict&gt;</span><br><span class="line">        &lt;/dict&gt;</span><br><span class="line">    &lt;/dict&gt;</span><br></pre></td></tr></table></figure>

<h4 id="5-设置URLType-找到Info-plist-右键，OpenAs-SourceCode-添加一下-分别是，QQ，微信，微博"><a href="#5-设置URLType-找到Info-plist-右键，OpenAs-SourceCode-添加一下-分别是，QQ，微信，微博" class="headerlink" title="5.设置URLType  找到Info.plist   右键，OpenAs SourceCode  添加一下(分别是，QQ，微信，微博)"></a>5.设置URLType  找到Info.plist   右键，OpenAs SourceCode  添加一下(分别是，QQ，微信，微博)</h4> <figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;key&gt;CFBundleURLTypes&lt;/key&gt;</span><br><span class="line">    &lt;array&gt;</span><br><span class="line">        &lt;dict&gt;</span><br><span class="line">            &lt;key&gt;CFBundleTypeRole&lt;/key&gt;</span><br><span class="line">            &lt;string&gt;Editor&lt;/string&gt;</span><br><span class="line">            &lt;key&gt;CFBundleURLName&lt;/key&gt;</span><br><span class="line">            &lt;string&gt;&lt;/string&gt;</span><br><span class="line">            &lt;key&gt;CFBundleURLSchemes&lt;/key&gt;</span><br><span class="line">            &lt;array&gt;</span><br><span class="line">                &lt;string&gt;wb3921700954&lt;/string&gt;</span><br><span class="line">            &lt;/array&gt;</span><br><span class="line">        &lt;/dict&gt;</span><br><span class="line">        &lt;dict&gt;</span><br><span class="line">            &lt;key&gt;CFBundleTypeRole&lt;/key&gt;</span><br><span class="line">            &lt;string&gt;Editor&lt;/string&gt;</span><br><span class="line">            &lt;key&gt;CFBundleURLName&lt;/key&gt;</span><br><span class="line">            &lt;string&gt;weixin&lt;/string&gt;</span><br><span class="line">            &lt;key&gt;CFBundleURLSchemes&lt;/key&gt;</span><br><span class="line">            &lt;array&gt;</span><br><span class="line">                &lt;string&gt;wxdc1e388c3822c80b&lt;/string&gt;</span><br><span class="line">            &lt;/array&gt;</span><br><span class="line">        &lt;/dict&gt;</span><br><span class="line">        &lt;dict&gt;</span><br><span class="line">            &lt;key&gt;CFBundleTypeRole&lt;/key&gt;</span><br><span class="line">            &lt;string&gt;Editor&lt;/string&gt;</span><br><span class="line">            &lt;key&gt;CFBundleURLSchemes&lt;/key&gt;</span><br><span class="line">            &lt;array&gt;</span><br><span class="line">                &lt;string&gt;tencent1105860513&lt;/string&gt;</span><br><span class="line">            &lt;/array&gt;</span><br><span class="line">        &lt;/dict&gt;</span><br><span class="line">        &lt;dict&gt;</span><br><span class="line">            &lt;key&gt;CFBundleTypeRole&lt;/key&gt;</span><br><span class="line">            &lt;string&gt;Editor&lt;/string&gt;</span><br><span class="line">            &lt;key&gt;CFBundleURLSchemes&lt;/key&gt;</span><br><span class="line">            &lt;array&gt;</span><br><span class="line">                &lt;string&gt;QQ0x41EA17A1&lt;/string&gt;</span><br><span class="line">            &lt;/array&gt;</span><br><span class="line">        &lt;/dict&gt;</span><br><span class="line">        &lt;dict&gt;</span><br><span class="line">            &lt;key&gt;CFBundleTypeRole&lt;/key&gt;</span><br><span class="line">            &lt;string&gt;Editor&lt;/string&gt;</span><br><span class="line">            &lt;key&gt;CFBundleURLSchemes&lt;/key&gt;</span><br><span class="line">            &lt;array&gt;</span><br><span class="line">                &lt;string&gt;wendu.dsbridgedemo&lt;/string&gt;</span><br><span class="line">            &lt;/array&gt;</span><br><span class="line">        &lt;/dict&gt;</span><br><span class="line">    &lt;/array&gt;</span><br></pre></td></tr></table></figure>

<h4 id="6-设置URLType-找到Info-plist-右键，OpenAs-SourceCode-添加一下"><a href="#6-设置URLType-找到Info-plist-右键，OpenAs-SourceCode-添加一下" class="headerlink" title="6.设置URLType  找到Info.plist   右键，OpenAs SourceCode  添加一下"></a>6.设置URLType  找到Info.plist   右键，OpenAs SourceCode  添加一下</h4>  <figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;key&gt;LSApplicationQueriesSchemes&lt;/key&gt;</span><br><span class="line">    &lt;array&gt;</span><br><span class="line">        &lt;string&gt;linkedin&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;linkedin-sdk2&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;linkedin-sdk&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;wechat&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;weixin&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;sinaweibohd&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;sinaweibo&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;sinaweibosso&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;weibosdk&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;weibosdk2.5&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;mqqapi&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;mqq&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;mqqOpensdkSSoLogin&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;mqqconnect&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;mqqopensdkdataline&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;mqqopensdkgrouptribeshare&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;mqqopensdkfriend&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;mqqopensdkapi&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;mqqopensdkapiV2&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;mqqopensdkapiV3&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;mqqopensdkapiV4&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;mqzoneopensdk&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;wtloginmqq&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;wtloginmqq2&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;mqqwpa&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;mqzone&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;mqzonev2&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;mqzoneshare&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;wtloginqzone&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;mqzonewx&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;mqzoneopensdkapiV2&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;mqzoneopensdkapi19&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;mqzoneopensdkapi&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;mqqbrowser&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;mttbrowser&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;TencentWeibo&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;tencentweiboSdkv2&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;alipay&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;alipayshare&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;renrenios&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;renrenapi&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;renren&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;renreniphone&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;laiwangsso&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;yixin&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;yixinopenapi&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;yixinoauth&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;yixinfav&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;laiwangsso&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;instagram&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;whatsapp&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;line&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;tumblr&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;fbapi&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;fb-messenger-api&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;fbauth2&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;fbshareextension&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;kakao6d5e4ca98ba3b944020c2c90953318e9&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;kakaokompassauth&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;storykompassauth&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;kakaolink&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;kakaotalk-4.5.0&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;kakaostory-2.9.0&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;pinterestsdk.v1&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;dingtalk&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;dingtalk-open&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;evernote&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;en&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;enx&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;evernotecid&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;evernotemsg&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;youdaonote&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;ynotedictfav&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;com.youdao.note.todayViewNote&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;ynotesharesdk&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;gplus&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;pocket&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;readitlater&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;pocket-oauth-v1&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;fb131450656879143&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;en-readitlater-5776&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;com.ideashower.ReadItLaterPro3&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;com.ideashower.ReadItLaterPro&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;com.ideashower.ReadItLaterProAlpha&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;com.ideashower.ReadItLaterProEnterprise&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;vk&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;vk-share&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;vkauthorize&lt;/string&gt;</span><br><span class="line">    &lt;/array&gt;</span><br></pre></td></tr></table></figure>

<h4 id="接下来可以快乐的commond-b-了"><a href="#接下来可以快乐的commond-b-了" class="headerlink" title="接下来可以快乐的commond + b 了"></a>接下来可以快乐的commond + b 了</h4><h4 id="初始化-在Appdelegate-m中-，导入头文件"><a href="#初始化-在Appdelegate-m中-，导入头文件" class="headerlink" title="初始化  在Appdelegate.m中  ，导入头文件"></a>初始化  在Appdelegate.m中  ，导入头文件</h4><p><code>#import &lt;UMSocialCore/UMSocialCore.h&gt;</code></p>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">//建议抽成一个单独的方法，别在一个函数里面执行太多的东西</span><br><span class="line">- (void)initUMShareSdk</span><br><span class="line">&#123;</span><br><span class="line">    //打开日志</span><br><span class="line">    [[UMSocialManager defaultManager] openLog:YES];</span><br><span class="line">    // 打开图片水印</span><br><span class="line">    //[UMSocialGlobal shareInstance].isUsingWaterMark = YES;</span><br><span class="line">    </span><br><span class="line">    // 获取友盟social版本号</span><br><span class="line">    UMSocialLogInfo(@&quot;UMeng social version: %@&quot;, [UMSocialGlobal umSocialSDKVersion]);</span><br><span class="line">    </span><br><span class="line">    //设置友盟appkey</span><br><span class="line">    [[UMSocialManager defaultManager] setUmSocialAppkey:@“your UMKey”];</span><br><span class="line">    </span><br><span class="line">    //设置微信的appKey和appSecret</span><br><span class="line">    [[UMSocialManager defaultManager] setPlaform:UMSocialPlatformType_WechatSession appKey:@&quot;wxdc1e388c3822c80b&quot; appSecret:@&quot;3baf1193c85774b3fd9d18447d76cab0&quot; redirectURL:@&quot;http://zhonfan.com&quot;];</span><br><span class="line">    /*</span><br><span class="line">     * 添加某一平台会加入平台下所有分享渠道，如微信：好友、朋友圈、收藏，QQ：QQ和QQ空间</span><br><span class="line">     * 以下接口可移除相应平台类型的分享，如微信收藏，对应类型可在枚举中查找</span><br><span class="line">     */</span><br><span class="line">    //[[UMSocialManager defaultManager] removePlatformProviderWithPlatformTypes:@[@(UMSocialPlatformType_WechatFavorite)]];</span><br><span class="line">    </span><br><span class="line">    // 设置分享到QQ互联的appID</span><br><span class="line">    // U-Share SDK为了兼容大部分平台命名，统一用appKey和appSecret进行参数设置，而QQ平台仅需将appID作为U-Share的appKey参数传进即可。</span><br><span class="line">    [[UMSocialManager defaultManager] setPlaform:UMSocialPlatformType_QQ appKey:@&quot;1105860513&quot;/*设置QQ平台的appID*/  appSecret:nil redirectURL:@&quot;http://zhonfan.com&quot;];</span><br><span class="line">    </span><br><span class="line">    //设置新浪的appKey和appSecret</span><br><span class="line">    [[UMSocialManager defaultManager] setPlaform:UMSocialPlatformType_Sina appKey:@&quot;3921700954&quot;  appSecret:@&quot;04b48b094faeb16683c32669824ebdad&quot; redirectURL:@&quot;http://zhonfan.com&quot;];</span><br><span class="line">&#125;</span><br><span class="line">//#define __IPHONE_10_0    100000</span><br><span class="line">#if __IPHONE_OS_VERSION_MAX_ALLOWED &gt; 100000</span><br><span class="line">- (BOOL)application:(UIApplication *)app openURL:(NSURL *)url options:(NSDictionary&lt;UIApplicationOpenURLOptionsKey, id&gt; *)options</span><br><span class="line">&#123;</span><br><span class="line">    BOOL result = [[UMSocialManager defaultManager] handleOpenURL:url];</span><br><span class="line">    if (!result) &#123;</span><br><span class="line">        // 其他如支付等SDK的回调</span><br><span class="line">    &#125;</span><br><span class="line">    return result;</span><br><span class="line">&#125;</span><br><span class="line">#endif</span><br><span class="line">- (BOOL)application:(UIApplication *)application openURL:(NSURL *)url sourceApplication:(NSString *)sourceApplication annotation:(id)annotation</span><br><span class="line">&#123;</span><br><span class="line">    BOOL result = [[UMSocialManager defaultManager] handleOpenURL:url];</span><br><span class="line">    if (!result) &#123;</span><br><span class="line">        // 其他如支付等SDK的回调</span><br><span class="line">    &#125;</span><br><span class="line">    return result;</span><br><span class="line">&#125;</span><br><span class="line">- (BOOL)application:(UIApplication *)application handleOpenURL:(NSURL *)url</span><br><span class="line">&#123;</span><br><span class="line">    BOOL result = [[UMSocialManager defaultManager] handleOpenURL:url];</span><br><span class="line">    if (!result) &#123;</span><br><span class="line">        // 其他如支付等SDK的回调</span><br><span class="line">    &#125;</span><br><span class="line">    return result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="OK-AppDelegate设置完成，接下来是如何调用"><a href="#OK-AppDelegate设置完成，接下来是如何调用" class="headerlink" title="OK AppDelegate设置完成，接下来是如何调用"></a>OK AppDelegate设置完成，接下来是如何调用</h4><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> 分享</span><br><span class="line"> @param obj obj 可为本地图片(UIImage类型),网络图片,(NSString类型,因为只能上传https的图片，所以内部使用SDWebImageManager，SDWebImage第三方库的一个类，使用这类进行图片下载处理)</span><br><span class="line"> */</span><br><span class="line">- (void)shareWithObj:(id)obj;</span><br></pre></td></tr></table></figure>

<p>使用这个分类进行处理，建议以后遇到类似的，继承或者分类，隔离一下</p>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-image">
        <a href="/2016/10/23/programming/" class="image is-7by1">
            <img class="thumbnail" src="https://images.pexels.com/photos/1194713/pexels-photo-1194713.jpeg?auto=format%2Ccompress&amp;cs=tinysrgb&amp;dpr=2&amp;w=500" alt="programming">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2016-10-23T15:38:08.000Z">2016-10-23</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/programing/">programing</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    几秒 读完 (大约 12 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2016/10/23/programming/">programming</a>
            
        </h1>
        <div class="content">
            <p><img src="https://policx.github.io/post-images/1560716152988.jpg" alt><br>红牛陪伴！</p>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-image">
        <a href="/2016/08/02/ioshuancun/" class="image is-7by1">
            <img class="thumbnail" src="https://www.policx.com/talk/images/banner.jpg" alt="iOS计算App缓存的大小以及清理">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2016-08-01T18:24:04.000Z">2016-08-02</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/programing/">programing</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    1 分钟 读完 (大约 200 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2016/08/02/ioshuancun/">iOS计算App缓存的大小以及清理</a>
            
        </h1>
        <div class="content">
            <h2 id="一、计算缓存"><a href="#一、计算缓存" class="headerlink" title="一、计算缓存"></a>一、计算缓存</h2><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">// 缓存大小</span><br><span class="line">- (CGFloat)folderSize&#123;</span><br><span class="line">    CGFloat folderSize;</span><br><span class="line">    //获取路径</span><br><span class="line">    NSString *cachePath = [NSSearchPathForDirectoriesInDomains(NSCachesDirectory,NSUserDomainMask,YES)firstObject];</span><br><span class="line">    </span><br><span class="line">    //获取所有文件的数组</span><br><span class="line">    NSArray *files = [[NSFileManager defaultManager] subpathsAtPath:cachePath];</span><br><span class="line">    </span><br><span class="line">    NSLog(@&quot;文件数：%ld&quot;,files.count);</span><br><span class="line">    </span><br><span class="line">    for(NSString *path in files) &#123;</span><br><span class="line">        </span><br><span class="line">        NSString*filePath = [cachePath stringByAppendingString:[NSString stringWithFormat:@&quot;/%@&quot;,path]];</span><br><span class="line">      </span><br><span class="line">  //累加</span><br><span class="line">        folderSize += [[NSFileManager defaultManager]attributesOfItemAtPath:filePath error:nil].fileSize; </span><br><span class="line">    &#125;</span><br><span class="line">    //转换为M为单位</span><br><span class="line">    CGFloat sizeM = folderSize /1024.0/1024.0;</span><br><span class="line">   </span><br><span class="line"> return sizeM;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="二、清除缓存"><a href="#二、清除缓存" class="headerlink" title="二、清除缓存"></a>二、清除缓存</h2><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">- (void)removeCache&#123;</span><br><span class="line">    //===============清除缓存==============</span><br><span class="line">    //获取路径</span><br><span class="line">    NSString*cachePath = [NSSearchPathForDirectoriesInDomains(NSCachesDirectory,NSUserDomainMask,YES)objectAtIndex:0];</span><br><span class="line">    </span><br><span class="line">    //返回路径中的文件数组</span><br><span class="line">    NSArray*files = [[NSFileManager defaultManager]subpathsAtPath:cachePath];</span><br><span class="line">    </span><br><span class="line">    NSLog(@&quot;文件数：%ld&quot;,[files count]);</span><br><span class="line">    for(NSString *p in files)&#123;</span><br><span class="line">        NSError*error;</span><br><span class="line">        </span><br><span class="line">        NSString*path = [cachePath stringByAppendingString:[NSString stringWithFormat:@&quot;/%@&quot;,p]];</span><br><span class="line">        </span><br><span class="line">        if([[NSFileManager defaultManager]fileExistsAtPath:path])</span><br><span class="line">               &#123;</span><br><span class="line">            BOOL isRemove = [[NSFileManager defaultManager]removeItemAtPath:path error:&amp;error];</span><br><span class="line">            if(isRemove) &#123;</span><br><span class="line">                NSLog(@&quot;清除成功&quot;);</span><br><span class="line">                //这里发送一个通知给外界，外界接收通知，可以做一些操作（比如UIAlertViewController）</span><br><span class="line">            &#125;else&#123;</span><br><span class="line">         </span><br><span class="line">                NSLog(@&quot;清除失败&quot;);</span><br><span class="line">                </span><br><span class="line">            &#125; </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
        </div>
        
        
        
    </div>
</div>









    
<div class="card card-transparent">
    <nav class="pagination is-centered" role="navigation" aria-label="pagination">
        <div class="pagination-previous is-invisible is-hidden-mobile">
            <a class="is-flex-grow has-text-black-ter" href="/categories/programing/page/0/">上一页</a>
        </div>
        <div class="pagination-next">
            <a class="is-flex-grow has-text-black-ter" href="/categories/programing/page/2/">下一页</a>
        </div>
        <ul class="pagination-list is-hidden-mobile">
            
            <li><a class="pagination-link is-current" href="/categories/programing/">1</a></li>
            
            <li><a class="pagination-link has-text-black-ter" href="/categories/programing/page/2/">2</a></li>
            
        </ul>
    </nav>
</div>
</div>
                




<div class="column is-4-tablet is-4-desktop is-3-widescreen  has-order-1 column-left is-sticky">
    
        
<div class="card widget">
    <div class="card-content">
        <nav class="level">
            <div class="level-item has-text-centered">
                <div>
                    
                        <img class="image is-128x128 has-mb-6" src="https://gitee.com/policx/im/raw/master/images/HQZ3sQ.png" alt="policx">
                    
                    
                    <p class="is-size-4 is-block">
                        policx
                    </p>
                    
                    
                    <p class="is-size-6 is-block">
                        heal the world
                    </p>
                    
                    
                    <p class="is-size-6 is-flex is-flex-center has-text-grey">
                        <i class="fas fa-map-marker-alt has-mr-7"></i>
                        <span>中国</span>
                    </p>
                    
                </div>
            </div>
        </nav>
        <nav class="level is-mobile">
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        文章
                    </p>
                    <p class="title has-text-weight-normal">
                        81
                    </p>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        分类
                    </p>
                    <p class="title has-text-weight-normal">
                        3
                    </p>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        标签
                    </p>
                    <p class="title has-text-weight-normal">
                        7
                    </p>
                </div>
            </div>
        </nav>
        <div class="level">
            <a class="level-item button is-link is-rounded" href="https://www.2345.com/?k.cn" target="_blank">
                关注我</a>
        </div>
        
        
        <div class="level is-mobile">
            
            <a class="level-item button is-white is-marginless" target="_blank" title="Github" href="https://developer.apple.com/">
                
                <i class="fab fa-apple"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" title="Facebook" href="https://docs.python.org/zh-cn/3.7/whatsnew/3.7.html">
                
                <i class="fab fa-python"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" title="Twitter" href="https://nodejs.org/zh-cn/">
                
                <i class="fab fa-node-js"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" title="Dribbble" href="https://developer.android.google.cn/">
                
                <i class="fab fa-android"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" title="RSS" href="/atom.xml">
                
                <i class="fas fa-rss"></i>
                
            </a>
            
        </div>
        
    </div>
</div>
    
    
        <div class="column-right-shadow is-hidden-widescreen ">
        
            
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            最新文章
        </h3>
        
        <article class="media">
            
            <a href="/2019/06/05/2019/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://www.policx.com/talk/images/2019.png" alt="WWDC 2019">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-06-05T03:06:39.000Z">2019-06-05</time></div>
                    <a href="/2019/06/05/2019/" class="has-link-black-ter is-size-6">WWDC 2019</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/news/">news</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2018/09/17/git-del/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="http://pic.baike.soso.com/ugc/baikepic2/12333/20160916155205-650847467.jpg/300" alt="git如何删除已经提交的文件夹">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-09-17T08:02:32.000Z">2018-09-17</time></div>
                    <a href="/2018/09/17/git-del/" class="has-link-black-ter is-size-6">git如何删除已经提交的文件夹</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2018/06/19/python-excel/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://i.loli.net/2019/06/22/5d0e4f2f57e4e99534.jpg" alt="Python利用openpyxl来操作Excel">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-06-19T08:39:16.000Z">2018-06-19</time></div>
                    <a href="/2018/06/19/python-excel/" class="has-link-black-ter is-size-6">Python利用openpyxl来操作Excel</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2018/06/17/python-writer/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://i.loli.net/2019/06/22/5d0e4f2f57e4e99534.jpg" alt="python操作excel的包(openpyxl、xlsxwriter)">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-06-17T10:28:27.000Z">2018-06-17</time></div>
                    <a href="/2018/06/17/python-writer/" class="has-link-black-ter is-size-6">python操作excel的包(openpyxl、xlsxwriter)</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2018/06/05/2018/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://www.policx.com/talk/images/2018.jpg" alt="WWDC 2018">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-06-04T16:59:59.000Z">2018-06-05</time></div>
                    <a href="/2018/06/05/2018/" class="has-link-black-ter is-size-6">WWDC 2018</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/news/">news</a>
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>

        
            
        
            
<div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                分类
            </h3>
            <ul class="menu-list">
            <li>
        <a class="level is-marginless" href="/categories/life/">
            <span class="level-start">
                <span class="level-item">life</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">14</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/news/">
            <span class="level-start">
                <span class="level-item">news</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">7</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/programing/">
            <span class="level-start">
                <span class="level-item">programing</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">11</span>
            </span>
        </a></li>
            </ul>
        </div>
    </div>
</div>
        
            <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            归档
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2019/06/">
                <span class="level-start">
                    <span class="level-item">六月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/09/">
                <span class="level-start">
                    <span class="level-item">九月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/06/">
                <span class="level-start">
                    <span class="level-item">六月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/05/">
                <span class="level-start">
                    <span class="level-item">五月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/04/">
                <span class="level-start">
                    <span class="level-item">四月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/03/">
                <span class="level-start">
                    <span class="level-item">三月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/02/">
                <span class="level-start">
                    <span class="level-item">二月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">7</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/09/">
                <span class="level-start">
                    <span class="level-item">九月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/08/">
                <span class="level-start">
                    <span class="level-item">八月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/06/">
                <span class="level-start">
                    <span class="level-item">六月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/03/">
                <span class="level-start">
                    <span class="level-item">三月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/02/">
                <span class="level-start">
                    <span class="level-item">二月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/01/">
                <span class="level-start">
                    <span class="level-item">一月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/12/">
                <span class="level-start">
                    <span class="level-item">十二月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/10/">
                <span class="level-start">
                    <span class="level-item">十月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/08/">
                <span class="level-start">
                    <span class="level-item">八月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/07/">
                <span class="level-start">
                    <span class="level-item">七月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/06/">
                <span class="level-start">
                    <span class="level-item">六月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">21</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/03/">
                <span class="level-start">
                    <span class="level-item">三月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/02/">
                <span class="level-start">
                    <span class="level-item">二月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/01/">
                <span class="level-start">
                    <span class="level-item">一月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2015/12/">
                <span class="level-start">
                    <span class="level-item">十二月 2015</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2015/11/">
                <span class="level-start">
                    <span class="level-item">十一月 2015</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2015/09/">
                <span class="level-start">
                    <span class="level-item">九月 2015</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2015/06/">
                <span class="level-start">
                    <span class="level-item">六月 2015</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2014/11/">
                <span class="level-start">
                    <span class="level-item">十一月 2014</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2014/09/">
                <span class="level-start">
                    <span class="level-item">九月 2014</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2014/08/">
                <span class="level-start">
                    <span class="level-item">八月 2014</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2014/06/">
                <span class="level-start">
                    <span class="level-item">六月 2014</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2014/05/">
                <span class="level-start">
                    <span class="level-item">五月 2014</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2014/03/">
                <span class="level-start">
                    <span class="level-item">三月 2014</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2013/07/">
                <span class="level-start">
                    <span class="level-item">七月 2013</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
        
            
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            标签云
        </h3>
        <a href="/tags/Django/" style="font-size: 12.5px;">Django</a> <a href="/tags/Hexo/" style="font-size: 10px;">Hexo</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/Markdown/" style="font-size: 10px;">Markdown</a> <a href="/tags/Python/" style="font-size: 17.5px;">Python</a> <a href="/tags/git/" style="font-size: 12.5px;">git</a> <a href="/tags//" style="font-size: 20px;"></a>
    </div>
</div>

        
            <div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                标签
            </h3>
            <div class="field is-grouped is-grouped-multiline">
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Django/">
                        <span class="tag">Django</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Hexo/">
                        <span class="tag">Hexo</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Linux/">
                        <span class="tag">Linux</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Markdown/">
                        <span class="tag">Markdown</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Python/">
                        <span class="tag">Python</span>
                        <span class="tag is-grey">6</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/git/">
                        <span class="tag">git</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags//">
                        <span class="tag"></span>
                        <span class="tag is-grey">16</span>
                    </a>
                </div>
                
            </div>
        </div>
    </div>
</div>
        
            

<div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            链接
        </h3>
        <ul class="menu-list">
        
            <li>
                <a class="level is-mobile" href="http://www.markdown.cn/" target="_blank">
                    <span class="level-left">
                        <span class="level-item">Markdown</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">www.markdown.cn</span>
                    </span>
                </a>
            </li>
        
            <li>
                <a class="level is-mobile" href="https://easyhexo.com" target="_blank">
                    <span class="level-left">
                        <span class="level-item">Easy Hexo</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">easyhexo.com</span>
                    </span>
                </a>
            </li>
        
            <li>
                <a class="level is-mobile" href="http://codezen.rishimohan.me/" target="_blank">
                    <span class="level-left">
                        <span class="level-item">CodeZen</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">codezen.rishimohan.me</span>
                    </span>
                </a>
            </li>
        
        </ul>
        </div>
    </div>
</div>


        
        </div>
    
</div>

                




<div class="column is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only has-order-3 column-right ">
    
        
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            最新文章
        </h3>
        
        <article class="media">
            
            <a href="/2019/06/05/2019/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://www.policx.com/talk/images/2019.png" alt="WWDC 2019">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-06-05T03:06:39.000Z">2019-06-05</time></div>
                    <a href="/2019/06/05/2019/" class="has-link-black-ter is-size-6">WWDC 2019</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/news/">news</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2018/09/17/git-del/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="http://pic.baike.soso.com/ugc/baikepic2/12333/20160916155205-650847467.jpg/300" alt="git如何删除已经提交的文件夹">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-09-17T08:02:32.000Z">2018-09-17</time></div>
                    <a href="/2018/09/17/git-del/" class="has-link-black-ter is-size-6">git如何删除已经提交的文件夹</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2018/06/19/python-excel/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://i.loli.net/2019/06/22/5d0e4f2f57e4e99534.jpg" alt="Python利用openpyxl来操作Excel">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-06-19T08:39:16.000Z">2018-06-19</time></div>
                    <a href="/2018/06/19/python-excel/" class="has-link-black-ter is-size-6">Python利用openpyxl来操作Excel</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2018/06/17/python-writer/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://i.loli.net/2019/06/22/5d0e4f2f57e4e99534.jpg" alt="python操作excel的包(openpyxl、xlsxwriter)">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-06-17T10:28:27.000Z">2018-06-17</time></div>
                    <a href="/2018/06/17/python-writer/" class="has-link-black-ter is-size-6">python操作excel的包(openpyxl、xlsxwriter)</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2018/06/05/2018/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://www.policx.com/talk/images/2018.jpg" alt="WWDC 2018">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-06-04T16:59:59.000Z">2018-06-05</time></div>
                    <a href="/2018/06/05/2018/" class="has-link-black-ter is-size-6">WWDC 2018</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/news/">news</a>
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>

    
        
    
        
<div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                分类
            </h3>
            <ul class="menu-list">
            <li>
        <a class="level is-marginless" href="/categories/life/">
            <span class="level-start">
                <span class="level-item">life</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">14</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/news/">
            <span class="level-start">
                <span class="level-item">news</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">7</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/programing/">
            <span class="level-start">
                <span class="level-item">programing</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">11</span>
            </span>
        </a></li>
            </ul>
        </div>
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            归档
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2019/06/">
                <span class="level-start">
                    <span class="level-item">六月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/09/">
                <span class="level-start">
                    <span class="level-item">九月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/06/">
                <span class="level-start">
                    <span class="level-item">六月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/05/">
                <span class="level-start">
                    <span class="level-item">五月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/04/">
                <span class="level-start">
                    <span class="level-item">四月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/03/">
                <span class="level-start">
                    <span class="level-item">三月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/02/">
                <span class="level-start">
                    <span class="level-item">二月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">7</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/09/">
                <span class="level-start">
                    <span class="level-item">九月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/08/">
                <span class="level-start">
                    <span class="level-item">八月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/06/">
                <span class="level-start">
                    <span class="level-item">六月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/03/">
                <span class="level-start">
                    <span class="level-item">三月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/02/">
                <span class="level-start">
                    <span class="level-item">二月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/01/">
                <span class="level-start">
                    <span class="level-item">一月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/12/">
                <span class="level-start">
                    <span class="level-item">十二月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/10/">
                <span class="level-start">
                    <span class="level-item">十月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/08/">
                <span class="level-start">
                    <span class="level-item">八月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/07/">
                <span class="level-start">
                    <span class="level-item">七月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/06/">
                <span class="level-start">
                    <span class="level-item">六月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">21</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/03/">
                <span class="level-start">
                    <span class="level-item">三月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/02/">
                <span class="level-start">
                    <span class="level-item">二月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/01/">
                <span class="level-start">
                    <span class="level-item">一月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2015/12/">
                <span class="level-start">
                    <span class="level-item">十二月 2015</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2015/11/">
                <span class="level-start">
                    <span class="level-item">十一月 2015</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2015/09/">
                <span class="level-start">
                    <span class="level-item">九月 2015</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2015/06/">
                <span class="level-start">
                    <span class="level-item">六月 2015</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2014/11/">
                <span class="level-start">
                    <span class="level-item">十一月 2014</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2014/09/">
                <span class="level-start">
                    <span class="level-item">九月 2014</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2014/08/">
                <span class="level-start">
                    <span class="level-item">八月 2014</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2014/06/">
                <span class="level-start">
                    <span class="level-item">六月 2014</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2014/05/">
                <span class="level-start">
                    <span class="level-item">五月 2014</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2014/03/">
                <span class="level-start">
                    <span class="level-item">三月 2014</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2013/07/">
                <span class="level-start">
                    <span class="level-item">七月 2013</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
    
        
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            标签云
        </h3>
        <a href="/tags/Django/" style="font-size: 12.5px;">Django</a> <a href="/tags/Hexo/" style="font-size: 10px;">Hexo</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/Markdown/" style="font-size: 10px;">Markdown</a> <a href="/tags/Python/" style="font-size: 17.5px;">Python</a> <a href="/tags/git/" style="font-size: 12.5px;">git</a> <a href="/tags//" style="font-size: 20px;"></a>
    </div>
</div>

    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                标签
            </h3>
            <div class="field is-grouped is-grouped-multiline">
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Django/">
                        <span class="tag">Django</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Hexo/">
                        <span class="tag">Hexo</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Linux/">
                        <span class="tag">Linux</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Markdown/">
                        <span class="tag">Markdown</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Python/">
                        <span class="tag">Python</span>
                        <span class="tag is-grey">6</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/git/">
                        <span class="tag">git</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags//">
                        <span class="tag"></span>
                        <span class="tag is-grey">16</span>
                    </a>
                </div>
                
            </div>
        </div>
    </div>
</div>
    
        

<div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            链接
        </h3>
        <ul class="menu-list">
        
            <li>
                <a class="level is-mobile" href="http://www.markdown.cn/" target="_blank">
                    <span class="level-left">
                        <span class="level-item">Markdown</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">www.markdown.cn</span>
                    </span>
                </a>
            </li>
        
            <li>
                <a class="level is-mobile" href="https://easyhexo.com" target="_blank">
                    <span class="level-left">
                        <span class="level-item">Easy Hexo</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">easyhexo.com</span>
                    </span>
                </a>
            </li>
        
            <li>
                <a class="level is-mobile" href="http://codezen.rishimohan.me/" target="_blank">
                    <span class="level-left">
                        <span class="level-item">CodeZen</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">codezen.rishimohan.me</span>
                    </span>
                </a>
            </li>
        
        </ul>
        </div>
    </div>
</div>


    
    
</div>

            </div>
        </div>
    </section>
    <footer class="footer">
    <div class="container">
        <div class="level">
            <div class="level-start has-text-centered-mobile">
                <a class="footer-logo is-block has-mb-6" href="/">
                    
                                <img src="/images/logo.gif" alt="POLICX" height="28">
                                
                </a>
                <p class="is-size-7">
                    &copy;
                    2019
                        policx&nbsp; Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> & <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank">Icarus</a>
                            
                                <br>
                                <span id="busuanzi_container_site_uv">
                共<span id="busuanzi_value_site_uv">0</span>个访客
                                </span>
                                
                </p>
            </div>
            <div class="level-end">
                
                    <div class="field has-addons is-flex-center-mobile has-mt-5-mobile is-flex-wrap is-flex-middle">
                        
                            
                                <p class="control">
                                    <a class="button is-white is-large" target="_blank" title="Creative Commons" href="https://www.2345.com/?k.cn">
                                        
                                                    <i class="fab fa-creative-commons"></i>
                                                    
                                    </a>
                                </p>
                                
                                <p class="control">
                                    <a class="button is-white is-large" target="_blank" title="Attribution 4.0 International" href="https://www.2345.com/?k.cn">
                                        
                                                    <i class="fab fa-creative-commons-by"></i>
                                                    
                                    </a>
                                </p>
                                
                                <p class="control">
                                    <a class="button is-white is-large" target="_blank" title="Download on GitHub" href="https://www.2345.com/?k.cn">
                                        
                                                    <i class="fab fa-github"></i>
                                                    
                                    </a>
                                </p>
                                
                    </div>
                    
            </div>
        </div>
    </div>
</footer>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script>
<script>moment.locale("zh-CN");</script>


    
    
    
    <script src="/js/animation.js"></script>
    

    
    
    
    <script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script>
    <script src="/js/gallery.js" defer></script>
    

    
    

<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update
            my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        });
    });
</script>


    
    
<script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    MathJax.Hub.Config({
        'HTML-CSS': {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
});
</script>

    
    

<a id="back-to-top" title="回到顶端" href="javascript:;">
    <i class="fas fa-chevron-up"></i>
</a>
<script src="/js/back-to-top.js" defer></script>


    
    

    
    
    
    

    
    
    
    
    
    <script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script>
    <script src="/js/clipboard.js" defer></script>
    

    
    
    

    


<script src="/js/main.js" defer></script>

    
    <div class="searchbox ins-search">
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="想要查找什么...">
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: '文章',
                PAGES: '页面',
                CATEGORIES: '分类',
                TAGS: '标签',
                UNTITLED: '(无标题)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/js/insight.js" defer></script>
<link rel="stylesheet" href="/css/search.css">
<link rel="stylesheet" href="/css/insight.css">
    
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"log":false});</script></body>
</html>